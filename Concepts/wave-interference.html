<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wave Interference â€¢ Physics Notebook</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/article.css">
    <style>
        /* AI Links */
        .ai-links {
            display: flex;
            gap: 0.8rem;
            margin-top: 1rem;
            align-items: center;
        }

        .ai-label {
            font-size: 0.8rem;
            opacity: 0.6;
            margin-right: 0.2rem;
            font-weight: 500;
        }

        .ai-btn {
            background: var(--bg-color);
            border: 1px solid var(--line-subtle);
            color: var(--text-muted);
            min-width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 0;
        }

        .ai-btn svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }
    </style>

    <!-- MathJax Configuration -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Theme Init -->
    <script>
        const savedTheme = localStorage.getItem('physics-notebook-theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        document.body && document.body.setAttribute('data-theme', savedTheme);
    </script>

    <!-- Libs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>

    <nav class="sticky">
        <div class="nav-bg"></div>
        <a href="../index.html" class="logo">
            <i data-lucide="arrow-left" width="16"></i>
            Library
        </a>
        <button id="themeBtn">
            <i data-lucide="moon" width="16"></i> Theme
        </button>
        <button id="audioBtn" class="icon-btn" style="margin-left: 0.5rem;" aria-label="Toggle Audio">
            <i data-lucide="volume-x" width="16"></i>
        </button>
    </nav>

    <!-- HERO -->
    <section class="hero">
        <div class="text-reveal-wrapper">
            <h1 class="hero-title">Wave<br>Interference</h1>
            <p style="margin-top: 2rem; font-size: 1.4rem; max-width: 40ch;">
                Unraveling the Principle of Superposition and the nature of constructive and destructive interference.
            </p>
        </div>
    </section>

    <!-- CHAPTER 1: SUPERPOSITION -->
    <section>
        <div class="split-layout">
            <div class="content-col">
                <h3 class="section-label" style="color: var(--accent);">01. The Principle</h3>
                <h2>Superposition</h2>
                <p>
                    When two or more waves overlap in space, the resultant displacement at any point is the
                    <strong>algebraic sum</strong> of the individual displacements. This implies that waves pass through
                    each other without being permanently altered; they merely add together while occupying the same
                    space.
                </p>
                <div class="math-block">
                    $$y_{total}(x,t) = y_1(x,t) + y_2(x,t)$$
                </div>
                <p>
                    This linearity is a fundamental property of the wave equation for small amplitudes. It allows
                    complex sounds, like a chord played on a piano, to be analyzed as a sum of individual sine waves
                    (Fourier Analysis).
                </p>

                <!-- ETU CARD -->
                <div class="etu-card">
                    <span class="etu-tag">Real World Analogy</span>
                    <h4 style="margin-bottom:0.5rem;">The Orchestra in the Air</h4>
                    <p style="font-size: 0.95rem; margin-bottom:0;">
                        Imagine sitting in a concert hall. The air molecule next to your ear is being pushed by pressure
                        waves from violins, cellos, and flutes simultaneously. It doesn't perform three separate dances;
                        it executes a single, complex motion that is the sum of all those individual pushes. Your ear
                        (and brain) then deconstructs this single signal back into individual instruments.
                    </p>
                </div>

                <!-- AI LINKS -->
                <div class="ai-links">
                    <span class="ai-label">Ask AI:</span>
                    <button onclick="openAI('superposition', 'perplexity')" class="ai-btn" title="Ask Perplexity">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M22.3977 7.0896h-2.3106V.0676l-7.5094 6.3542V.1577h-1.1554v6.1966L4.4904 0v7.0896H1.6023v10.3976h2.8882V24l6.932-6.3591v6.2005h1.1554v-6.0469l6.9318 6.1807v-6.4879h2.8882V7.0896zm-3.4657-4.531v4.531h-5.355l5.355-4.531zm-13.2862.0676 4.8691 4.4634H5.6458V2.6262zM2.7576 16.332V8.245h7.8476l-6.1149 6.1147v1.9723H2.7576zm2.8882 5.0404v-3.8852h.0001v-2.6488l5.7763-5.7764v7.0111l-5.7764 5.2993zm12.7086.0248-5.7766-5.1509V9.0618l5.7766 5.7766v6.5588zm2.8882-5.0652h-1.733v-1.9723L13.3948 8.245h7.8478v8.087z" />
                        </svg>
                    </button>
                    <button onclick="openAI('superposition', 'gemini')" class="ai-btn" title="Ask Gemini">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M11.04 19.32Q12 21.51 12 24q0-2.49.93-4.68.96-2.19 2.58-3.81t3.81-2.55Q21.51 12 24 12q-2.49 0-4.68-.93a12.3 12.3 0 0 1-3.81-2.58 12.3 12.3 0 0 1-2.58-3.81Q12 2.49 12 0q0 2.49-.96 4.68-.93 2.19-2.55 3.81a12.3 12.3 0 0 1-3.81 2.58Q2.49 12 0 12q2.49 0 4.68.96 2.19.93 3.81 2.55t2.55 3.81" />
                        </svg>
                    </button>
                    <button onclick="openAI('superposition', 'chatgpt')" class="ai-btn" title="Ask ChatGPT">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M22.2819 9.8211a5.9847 5.9847 0 0 0-.5157-4.9108 6.0462 6.0462 0 0 0-6.5098-2.9A6.0651 6.0651 0 0 0 4.9807 4.1818a5.9847 5.9847 0 0 0-3.9977 2.9 6.0462 6.0462 0 0 0 .7427 7.0966 5.98 5.98 0 0 0 .511 4.9107 6.051 6.051 0 0 0 6.5146 2.9001A5.9847 5.9847 0 0 0 13.2599 24a6.0557 6.0557 0 0 0 5.7718-4.2058 5.9894 5.9894 0 0 0 3.9977-2.9001 6.0557 6.0557 0 0 0-.7475-7.0729zm-9.022 12.6081a4.4755 4.4755 0 0 1-2.8764-1.0408l.1419-.0804 4.7783-2.7582a.7948.7948 0 0 0 .3927-.6813v-6.7369l2.02 1.1686a.071.071 0 0 1 .038.052v5.5826a4.504 4.504 0 0 1-4.4945 4.4944zm-9.6607-4.1254a4.4708 4.4708 0 0 1-.5346-3.0137l.142.0852 4.783 2.7582a.7712.7712 0 0 0 .7806 0l5.8428-3.3685v2.3324a.0804.0804 0 0 1-.0332.0615L9.74 19.9502a4.4992 4.4992 0 0 1-6.1408-1.6464zM2.3408 7.8956a4.485 4.485 0 0 1 2.3655-1.9728V11.6a.7664.7664 0 0 0 .3879.6765l5.8144 3.3543-2.0201 1.1685a.0757.0757 0 0 1-.071 0l-4.8303-2.7865A4.504 4.504 0 0 1 2.3408 7.872zm16.5963 3.8558L13.1038 8.364 15.1192 7.2a.0757.0757 0 0 1 .071 0l4.8303 2.7913a4.4944 4.4944 0 0 1-.6765 8.1042v-5.6772a.79.79 0 0 0-.407-.667zm2.0107-3.0231l-.142-.0852-4.7735-2.7818a.7759.7759 0 0 0-.7854 0L9.409 9.2297V6.8974a.0662.0662 0 0 1 .0284-.0615l4.8303-2.7866a4.4992 4.4992 0 0 1 6.6802 4.66zM8.3065 12.863l-2.02-1.1638a.0804.0804 0 0 1-.038-.0567V6.0742a4.4992 4.4992 0 0 1 7.3757-3.4537l-.142.0805L8.704 5.459a.7948.7948 0 0 0-.3927.6813zm1.0976-2.3654l2.602-1.4998 2.6069 1.4998v2.9994l-2.5974 1.4997-2.6067-1.4997Z" />
                        </svg>
                    </button>
                    <button onclick="openAI('superposition', 'claude')" class="ai-btn" title="Ask Claude">
                        <svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision"
                            text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd"
                            clip-rule="evenodd" viewBox="0 0 512 509.64">
                            <path fill="#D77655"
                                d="M115.612 0h280.775C459.974 0 512 52.026 512 115.612v278.415c0 63.587-52.026 115.612-115.613 115.612H115.612C52.026 509.639 0 457.614 0 394.027V115.612C0 52.026 52.026 0 115.612 0z" />
                            <path fill="#FCF2EE" fill-rule="nonzero"
                                d="M142.27 316.619l73.655-41.326 1.238-3.589-1.238-1.996-3.589-.001-12.31-.759-42.084-1.138-36.498-1.516-35.361-1.896-8.897-1.895-8.34-10.995.859-5.484 7.482-5.03 10.717.935 23.683 1.617 35.537 2.452 25.782 1.517 38.193 3.968h6.064l.86-2.451-2.073-1.517-1.618-1.517-36.776-24.922-39.81-26.338-20.852-15.166-11.273-7.683-5.687-7.204-2.451-15.721 10.237-11.273 13.75.935 3.513.936 13.928 10.716 29.749 23.027 38.848 28.612 5.687 4.727 2.275-1.617.278-1.138-2.553-4.271-21.13-38.193-22.546-38.848-10.035-16.101-2.654-9.655c-.935-3.968-1.617-7.304-1.617-11.374l11.652-15.823 6.445-2.073 15.545 2.073 6.547 5.687 9.655 22.092 15.646 34.78 24.265 47.291 7.103 14.028 3.791 12.992 1.416 3.968 2.449-.001v-2.275l1.997-26.641 3.69-32.707 3.589-42.084 1.239-11.854 5.863-14.206 11.652-7.683 9.099 4.348 7.482 10.716-1.036 6.926-4.449 28.915-8.72 45.294-5.687 30.331h3.313l3.792-3.791 15.342-20.372 25.782-32.227 11.374-12.789 13.27-14.129 8.517-6.724 16.1-.001 11.854 17.617-5.307 18.199-16.581 21.029-13.75 17.819-19.716 26.54-12.309 21.231 1.138 1.694 2.932-.278 44.536-9.479 24.062-4.347 28.714-4.928 12.992 6.066 1.416 6.167-5.106 12.613-30.71 7.583-36.018 7.204-53.636 12.689-.657.48.758.935 24.164 2.275 10.337.556h25.301l47.114 3.514 12.309 8.139 7.381 9.959-1.238 7.583-18.957 9.655-25.579-6.066-59.702-14.205-20.474-5.106-2.83-.001v1.694l17.061 16.682 31.266 28.233 39.152 36.397 1.997 8.999-5.03 7.102-5.307-.758-34.401-25.883-13.27-11.651-30.053-25.302-1.996-.001v2.654l6.926 10.136 36.574 54.975 1.895 16.859-2.653 5.485-9.479 3.311-10.414-1.895-21.408-30.054-22.092-33.844-17.819-30.331-2.173 1.238-10.515 113.261-4.929 5.788-11.374 4.348-9.478-7.204-5.03-11.652 5.03-23.027 6.066-30.052 4.928-23.886 4.449-29.674 2.654-9.858-.177-.657-2.173.278-22.37 30.71-34.021 45.977-26.919 28.815-6.445 2.553-11.173-5.789 1.037-10.337 6.243-9.2 37.257-47.392 22.47-29.371 14.508-16.961-.101-2.451h-.859l-98.954 64.251-17.618 2.275-7.583-7.103.936-11.652 3.589-3.791 29.749-20.474-.101.102.024.101z" />
                        </svg>
                    </button>
                    <button onclick="openAI('superposition', 'grok')" class="ai-btn" title="Ask Grok">
                        <svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision"
                            text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd"
                            clip-rule="evenodd" viewBox="0 0 512 509.641">
                            <path
                                d="M115.612 0h280.776C459.975 0 512 52.026 512 115.612v278.416c0 63.587-52.025 115.613-115.612 115.613H115.612C52.026 509.641 0 457.615 0 394.028V115.612C0 52.026 52.026 0 115.612 0z" />
                            <path fill="#fff"
                                d="M213.235 306.019l178.976-180.002v.169l51.695-51.763c-.924 1.32-1.86 2.605-2.785 3.89-39.281 54.164-58.46 80.649-43.07 146.922l-.09-.101c10.61 45.11-.744 95.137-37.398 131.836-46.216 46.306-120.167 56.611-181.063 14.928l42.462-19.675c38.863 15.278 81.392 8.57 111.947-22.03 30.566-30.6 37.432-75.159 22.065-112.252-2.92-7.025-11.67-8.795-17.792-4.263l-124.947 92.341zm-25.786 22.437l-.033.034L68.094 435.217c7.565-10.429 16.957-20.294 26.327-30.149 26.428-27.803 52.653-55.359 36.654-94.302-21.422-52.112-8.952-113.177 30.724-152.898 41.243-41.254 101.98-51.661 152.706-30.758 11.23 4.172 21.016 10.114 28.638 15.639l-42.359 19.584c-39.44-16.563-84.629-5.299-112.207 22.313-37.298 37.308-44.84 102.003-1.128 143.81z" />
                        </svg>
                    </button>
                </div>
            </div>
            <div class="visual-col">
                <canvas id="canvas-superposition"></canvas>
            </div>
        </div>
    </section>

    <div class="divider"></div>

    <!-- CHAPTER 2: INTERFERENCE -->
    <section>
        <div class="split-layout">
            <div class="content-col">
                <h3 class="section-label" style="color: var(--accent-secondary);">02. Interaction</h3>
                <h2>Constructive & Destructive</h2>
                <p>
                    The nature of the superposition depends critically on the <strong>phase difference</strong> ($\Delta
                    \phi$) between the waves. If the crest of one meets the crest of another, they reinforce. If a crest
                    meets a trough, they cancel.
                </p>
                <div class="math-block">
                    $$\Delta \phi = k\Delta x + \Delta \phi_0$$
                </div>
                <p>
                    For two identical sources, the interference condition is often defined by the <em>path length
                        difference</em> ($\Delta x$):
                </p>
                <ul style="margin-top: 1rem; padding-left: 1.2rem; line-height: 1.6;">
                    <li><strong>Constructive</strong>: $\Delta x = n\lambda$ (Integer wavelengths)</li>
                    <li><strong>Destructive</strong>: $\Delta x = (n + \frac{1}{2})\lambda$ (Half-integer wavelengths)
                    </li>
                </ul>

                <!-- ETU CARD -->
                <div class="etu-card">
                    <span class="etu-tag">Real World Analogy</span>
                    <h4 style="margin-bottom:0.5rem;">Active Noise Cancellation</h4>
                    <p style="font-size: 0.95rem; margin-bottom:0;">
                        Noise-canceling headphones have a microphone that listens to ambient noise (like a jet engine).
                        They essentially calculate the wave profile of the noise and instantly generate an "anti-wave"
                        that is exactly $180^\circ$ ($\pi$ radians) out of phase. When this anti-wave meets the noise in
                        your ear canal, they destructively interfere, summing to near zero silence.
                    </p>
                </div>

                <!-- AI LINKS -->
                <div class="ai-links">
                    <span class="ai-label">Ask AI:</span>
                    <button onclick="openAI('interference', 'perplexity')" class="ai-btn" title="Ask Perplexity">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M22.3977 7.0896h-2.3106V.0676l-7.5094 6.3542V.1577h-1.1554v6.1966L4.4904 0v7.0896H1.6023v10.3976h2.8882V24l6.932-6.3591v6.2005h1.1554v-6.0469l6.9318 6.1807v-6.4879h2.8882V7.0896zm-3.4657-4.531v4.531h-5.355l5.355-4.531zm-13.2862.0676 4.8691 4.4634H5.6458V2.6262zM2.7576 16.332V8.245h7.8476l-6.1149 6.1147v1.9723H2.7576zm2.8882 5.0404v-3.8852h.0001v-2.6488l5.7763-5.7764v7.0111l-5.7764 5.2993zm12.7086.0248-5.7766-5.1509V9.0618l5.7766 5.7766v6.5588zm2.8882-5.0652h-1.733v-1.9723L13.3948 8.245h7.8478v8.087z" />
                        </svg>
                    </button>
                    <button onclick="openAI('interference', 'gemini')" class="ai-btn" title="Ask Gemini">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M11.04 19.32Q12 21.51 12 24q0-2.49.93-4.68.96-2.19 2.58-3.81t3.81-2.55Q21.51 12 24 12q-2.49 0-4.68-.93a12.3 12.3 0 0 1-3.81-2.58 12.3 12.3 0 0 1-2.58-3.81Q12 2.49 12 0q0 2.49-.96 4.68-.93 2.19-2.55 3.81a12.3 12.3 0 0 1-3.81 2.58Q2.49 12 0 12q2.49 0 4.68.96 2.19.93 3.81 2.55t2.55 3.81" />
                        </svg>
                    </button>
                    <button onclick="openAI('interference', 'chatgpt')" class="ai-btn chatgpt-btn" title="Ask ChatGPT">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M22.2819 9.8211a5.9847 5.9847 0 0 0-.5157-4.9108 6.0462 6.0462 0 0 0-6.5098-2.9A6.0651 6.0651 0 0 0 4.9807 4.1818a5.9847 5.9847 0 0 0-3.9977 2.9 6.0462 6.0462 0 0 0 .7427 7.0966 5.98 5.98 0 0 0 .511 4.9107 6.051 6.051 0 0 0 6.5146 2.9001A5.9847 5.9847 0 0 0 13.2599 24a6.0557 6.0557 0 0 0 5.7718-4.2058 5.9894 5.9894 0 0 0 3.9977-2.9001 6.0557 6.0557 0 0 0-.7475-7.0729zm-9.022 12.6081a4.4755 4.4755 0 0 1-2.8764-1.0408l.1419-.0804 4.7783-2.7582a.7948.7948 0 0 0 .3927-.6813v-6.7369l2.02 1.1686a.071.071 0 0 1 .038.052v5.5826a4.504 4.504 0 0 1-4.4945 4.4944zm-9.6607-4.1254a4.4708 4.4708 0 0 1-.5346-3.0137l.142.0852 4.783 2.7582a.7712.7712 0 0 0 .7806 0l5.8428-3.3685v2.3324a.0804.0804 0 0 1-.0332.0615L9.74 19.9502a4.4992 4.4992 0 0 1-6.1408-1.6464zM2.3408 7.8956a4.485 4.485 0 0 1 2.3655-1.9728V11.6a.7664.7664 0 0 0 .3879.6765l5.8144 3.3543-2.0201 1.1685a.0757.0757 0 0 1-.071 0l-4.8303-2.7865A4.504 4.504 0 0 1 2.3408 7.872zm16.5963 3.8558L13.1038 8.364 15.1192 7.2a.0757.0757 0 0 1 .071 0l4.8303 2.7913a4.4944 4.4944 0 0 1-.6765 8.1042v-5.6772a.79.79 0 0 0-.407-.667zm2.0107-3.0231l-.142-.0852-4.7735-2.7818a.7759.7759 0 0 0-.7854 0L9.409 9.2297V6.8974a.0662.0662 0 0 1 .0284-.0615l4.8303-2.7866a4.4992 4.4992 0 0 1 6.6802 4.66zM8.3065 12.863l-2.02-1.1638a.0804.0804 0 0 1-.038-.0567V6.0742a4.4992 4.4992 0 0 1 7.3757-3.4537l-.142.0805L8.704 5.459a.7948.7948 0 0 0-.3927.6813zm1.0976-2.3654l2.602-1.4998 2.6069 1.4998v2.9994l-2.5974 1.4997-2.6067-1.4997Z" />
                        </svg>
                    </button>
                    <button onclick="openAI('interference', 'claude')" class="ai-btn" title="Ask Claude">
                        <svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision"
                            text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd"
                            clip-rule="evenodd" viewBox="0 0 512 509.64">
                            <path fill="#D77655"
                                d="M115.612 0h280.775C459.974 0 512 52.026 512 115.612v278.415c0 63.587-52.026 115.612-115.613 115.612H115.612C52.026 509.639 0 457.614 0 394.027V115.612C0 52.026 52.026 0 115.612 0z" />
                            <path fill="#FCF2EE" fill-rule="nonzero"
                                d="M142.27 316.619l73.655-41.326 1.238-3.589-1.238-1.996-3.589-.001-12.31-.759-42.084-1.138-36.498-1.516-35.361-1.896-8.897-1.895-8.34-10.995.859-5.484 7.482-5.03 10.717.935 23.683 1.617 35.537 2.452 25.782 1.517 38.193 3.968h6.064l.86-2.451-2.073-1.517-1.618-1.517-36.776-24.922-39.81-26.338-20.852-15.166-11.273-7.683-5.687-7.204-2.451-15.721 10.237-11.273 13.75.935 3.513.936 13.928 10.716 29.749 23.027 38.848 28.612 5.687 4.727 2.275-1.617.278-1.138-2.553-4.271-21.13-38.193-22.546-38.848-10.035-16.101-2.654-9.655c-.935-3.968-1.617-7.304-1.617-11.374l11.652-15.823 6.445-2.073 15.545 2.073 6.547 5.687 9.655 22.092 15.646 34.78 24.265 47.291 7.103 14.028 3.791 12.992 1.416 3.968 2.449-.001v-2.275l1.997-26.641 3.69-32.707 3.589-42.084 1.239-11.854 5.863-14.206 11.652-7.683 9.099 4.348 7.482 10.716-1.036 6.926-4.449 28.915-8.72 45.294-5.687 30.331h3.313l3.792-3.791 15.342-20.372 25.782-32.227 11.374-12.789 13.27-14.129 8.517-6.724 16.1-.001 11.854 17.617-5.307 18.199-16.581 21.029-13.75 17.819-19.716 26.54-12.309 21.231 1.138 1.694 2.932-.278 44.536-9.479 24.062-4.347 28.714-4.928 12.992 6.066 1.416 6.167-5.106 12.613-30.71 7.583-36.018 7.204-53.636 12.689-.657.48.758.935 24.164 2.275 10.337.556h25.301l47.114 3.514 12.309 8.139 7.381 9.959-1.238 7.583-18.957 9.655-25.579-6.066-59.702-14.205-20.474-5.106-2.83-.001v1.694l17.061 16.682 31.266 28.233 39.152 36.397 1.997 8.999-5.03 7.102-5.307-.758-34.401-25.883-13.27-11.651-30.053-25.302-1.996-.001v2.654l6.926 10.136 36.574 54.975 1.895 16.859-2.653 5.485-9.479 3.311-10.414-1.895-21.408-30.054-22.092-33.844-17.819-30.331-2.173 1.238-10.515 113.261-4.929 5.788-11.374 4.348-9.478-7.204-5.03-11.652 5.03-23.027 6.066-30.052 4.928-23.886 4.449-29.674 2.654-9.858-.177-.657-2.173.278-22.37 30.71-34.021 45.977-26.919 28.815-6.445 2.553-11.173-5.789 1.037-10.337 6.243-9.2 37.257-47.392 22.47-29.371 14.508-16.961-.101-2.451h-.859l-98.954 64.251-17.618 2.275-7.583-7.103.936-11.652 3.589-3.791 29.749-20.474-.101.102.024.101z" />
                        </svg>
                    </button>
                    <button onclick="openAI('interference', 'grok')" class="ai-btn" title="Ask Grok">
                        <svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision"
                            text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd"
                            clip-rule="evenodd" viewBox="0 0 512 509.641">
                            <path
                                d="M115.612 0h280.776C459.975 0 512 52.026 512 115.612v278.416c0 63.587-52.025 115.613-115.612 115.613H115.612C52.026 509.641 0 457.615 0 394.028V115.612C0 52.026 52.026 0 115.612 0z" />
                            <path fill="#fff"
                                d="M213.235 306.019l178.976-180.002v.169l51.695-51.763c-.924 1.32-1.86 2.605-2.785 3.89-39.281 54.164-58.46 80.649-43.07 146.922l-.09-.101c10.61 45.11-.744 95.137-37.398 131.836-46.216 46.306-120.167 56.611-181.063 14.928l42.462-19.675c38.863 15.278 81.392 8.57 111.947-22.03 30.566-30.6 37.432-75.159 22.065-112.252-2.92-7.025-11.67-8.795-17.792-4.263l-124.947 92.341zm-25.786 22.437l-.033.034L68.094 435.217c7.565-10.429 16.957-20.294 26.327-30.149 26.428-27.803 52.653-55.359 36.654-94.302-21.422-52.112-8.952-113.177 30.724-152.898 41.243-41.254 101.98-51.661 152.706-30.758 11.23 4.172 21.016 10.114 28.638 15.639l-42.359 19.584c-39.44-16.563-84.629-5.299-112.207 22.313-37.298 37.308-44.84 102.003-1.128 143.81z" />
                        </svg>
                    </button>
                </div>
                <div class="sim-controls">
                    <div class="slider-group">
                        <label>Phase Shift ($\phi$) <span id="val-phase">0</span>&deg;</label>
                        <input type="range" id="input-phase" min="0" max="360" step="1" value="0">
                    </div>
                </div>
            </div>
            <div class="visual-col">
                <canvas id="canvas-interference"></canvas>
            </div>
        </div>
    </section>

    <div class="divider"></div>

    <!-- CHAPTER 3: BEATS (Optional but cool) -->
    <section>
        <div class="split-layout">
            <div class="content-col">
                <h3 class="section-label" style="color: var(--text-muted);">03. Phenomena</h3>
                <h2>Beats</h2>
                <p>
                    When two waves with slightly different angular frequencies $\omega_1$ and $\omega_2$ interfere, the
                    resulting wave can be described by a fast oscillation modulated by a slowly varying envelope.
                </p>
                <div class="math-block">
                    $$y_{total} = \left[ 2A \cos\left(\frac{\omega_1 - \omega_2}{2}t\right) \right]
                    \sin\left(\frac{\omega_1 + \omega_2}{2}t\right)$$
                </div>
                <p>
                    The term in square brackets represents the time-varying amplitude. The loudness rises and falls at
                    the <strong>beat frequency</strong>, which is simply the difference between the two source
                    frequencies.
                </p>
                <div class="math-block">
                    $$f_{beat} = |f_1 - f_2|$$
                </div>

                <!-- ETU CARD -->
                <div class="etu-card">
                    <span class="etu-tag">Real World Analogy</span>
                    <h4 style="margin-bottom:0.5rem;">Tuning Guitar Strings</h4>
                    <p style="font-size: 0.95rem; margin-bottom:0;">
                        Musicians tune their instruments by listening for these beats. If a guitar string is slightly
                        out of tune with a reference note, you hear a "waw-waw-waw" pulsating sound. As you tighten the
                        string and the frequencies get closer, the beats slow down. When the beats disappear completely,
                        the frequencies are identical, and the instrument is in tune.
                    </p>
                </div>

                <!-- AI LINKS -->
                <div class="ai-links">
                    <span class="ai-label">Ask AI:</span>
                    <button onclick="openAI('beats', 'perplexity')" class="ai-btn" title="Ask Perplexity">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M22.3977 7.0896h-2.3106V.0676l-7.5094 6.3542V.1577h-1.1554v6.1966L4.4904 0v7.0896H1.6023v10.3976h2.8882V24l6.932-6.3591v6.2005h1.1554v-6.0469l6.9318 6.1807v-6.4879h2.8882V7.0896zm-3.4657-4.531v4.531h-5.355l5.355-4.531zm-13.2862.0676 4.8691 4.4634H5.6458V2.6262zM2.7576 16.332V8.245h7.8476l-6.1149 6.1147v1.9723H2.7576zm2.8882 5.0404v-3.8852h.0001v-2.6488l5.7763-5.7764v7.0111l-5.7764 5.2993zm12.7086.0248-5.7766-5.1509V9.0618l5.7766 5.7766v6.5588zm2.8882-5.0652h-1.733v-1.9723L13.3948 8.245h7.8478v8.087z" />
                        </svg>
                    </button>
                    <button onclick="openAI('beats', 'gemini')" class="ai-btn" title="Ask Gemini">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M11.04 19.32Q12 21.51 12 24q0-2.49.93-4.68.96-2.19 2.58-3.81t3.81-2.55Q21.51 12 24 12q-2.49 0-4.68-.93a12.3 12.3 0 0 1-3.81-2.58 12.3 12.3 0 0 1-2.58-3.81Q12 2.49 12 0q0 2.49-.96 4.68-.93 2.19-2.55 3.81a12.3 12.3 0 0 1-3.81 2.58Q2.49 12 0 12q2.49 0 4.68.96 2.19.93 3.81 2.55t2.55 3.81" />
                        </svg>
                    </button>
                    <button onclick="openAI('beats', 'chatgpt')" class="ai-btn chatgpt-btn" title="Ask ChatGPT">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M22.2819 9.8211a5.9847 5.9847 0 0 0-.5157-4.9108 6.0462 6.0462 0 0 0-6.5098-2.9A6.0651 6.0651 0 0 0 4.9807 4.1818a5.9847 5.9847 0 0 0-3.9977 2.9 6.0462 6.0462 0 0 0 .7427 7.0966 5.98 5.98 0 0 0 .511 4.9107 6.051 6.051 0 0 0 6.5146 2.9001A5.9847 5.9847 0 0 0 13.2599 24a6.0557 6.0557 0 0 0 5.7718-4.2058 5.9894 5.9894 0 0 0 3.9977-2.9001 6.0557 6.0557 0 0 0-.7475-7.0729zm-9.022 12.6081a4.4755 4.4755 0 0 1-2.8764-1.0408l.1419-.0804 4.7783-2.7582a.7948.7948 0 0 0 .3927-.6813v-6.7369l2.02 1.1686a.071.071 0 0 1 .038.052v5.5826a4.504 4.504 0 0 1-4.4945 4.4944zm-9.6607-4.1254a4.4708 4.4708 0 0 1-.5346-3.0137l.142.0852 4.783 2.7582a.7712.7712 0 0 0 .7806 0l5.8428-3.3685v2.3324a.0804.0804 0 0 1-.0332.0615L9.74 19.9502a4.4992 4.4992 0 0 1-6.1408-1.6464zM2.3408 7.8956a4.485 4.485 0 0 1 2.3655-1.9728V11.6a.7664.7664 0 0 0 .3879.6765l5.8144 3.3543-2.0201 1.1685a.0757.0757 0 0 1-.071 0l-4.8303-2.7865A4.504 4.504 0 0 1 2.3408 7.872zm16.5963 3.8558L13.1038 8.364 15.1192 7.2a.0757.0757 0 0 1 .071 0l4.8303 2.7913a4.4944 4.4944 0 0 1-.6765 8.1042v-5.6772a.79.79 0 0 0-.407-.667zm2.0107-3.0231l-.142-.0852-4.7735-2.7818a.7759.7759 0 0 0-.7854 0L9.409 9.2297V6.8974a.0662.0662 0 0 1 .0284-.0615l4.8303-2.7866a4.4992 4.4992 0 0 1 6.6802 4.66zM8.3065 12.863l-2.02-1.1638a.0804.0804 0 0 1-.038-.0567V6.0742a4.4992 4.4992 0 0 1 7.3757-3.4537l-.142.0805L8.704 5.459a.7948.7948 0 0 0-.3927.6813zm1.0976-2.3654l2.602-1.4998 2.6069 1.4998v2.9994l-2.5974 1.4997-2.6067-1.4997Z" />
                        </svg>
                    </button>
                    <button onclick="openAI('beats', 'claude')" class="ai-btn" title="Ask Claude">
                        <svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision"
                            text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd"
                            clip-rule="evenodd" viewBox="0 0 512 509.64">
                            <path fill="#D77655"
                                d="M115.612 0h280.775C459.974 0 512 52.026 512 115.612v278.415c0 63.587-52.026 115.612-115.613 115.612H115.612C52.026 509.639 0 457.614 0 394.027V115.612C0 52.026 52.026 0 115.612 0z" />
                            <path fill="#FCF2EE" fill-rule="nonzero"
                                d="M142.27 316.619l73.655-41.326 1.238-3.589-1.238-1.996-3.589-.001-12.31-.759-42.084-1.138-36.498-1.516-35.361-1.896-8.897-1.895-8.34-10.995.859-5.484 7.482-5.03 10.717.935 23.683 1.617 35.537 2.452 25.782 1.517 38.193 3.968h6.064l.86-2.451-2.073-1.517-1.618-1.517-36.776-24.922-39.81-26.338-20.852-15.166-11.273-7.683-5.687-7.204-2.451-15.721 10.237-11.273 13.75.935 3.513.936 13.928 10.716 29.749 23.027 38.848 28.612 5.687 4.727 2.275-1.617.278-1.138-2.553-4.271-21.13-38.193-22.546-38.848-10.035-16.101-2.654-9.655c-.935-3.968-1.617-7.304-1.617-11.374l11.652-15.823 6.445-2.073 15.545 2.073 6.547 5.687 9.655 22.092 15.646 34.78 24.265 47.291 7.103 14.028 3.791 12.992 1.416 3.968 2.449-.001v-2.275l1.997-26.641 3.69-32.707 3.589-42.084 1.239-11.854 5.863-14.206 11.652-7.683 9.099 4.348 7.482 10.716-1.036 6.926-4.449 28.915-8.72 45.294-5.687 30.331h3.313l3.792-3.791 15.342-20.372 25.782-32.227 11.374-12.789 13.27-14.129 8.517-6.724 16.1-.001 11.854 17.617-5.307 18.199-16.581 21.029-13.75 17.819-19.716 26.54-12.309 21.231 1.138 1.694 2.932-.278 44.536-9.479 24.062-4.347 28.714-4.928 12.992 6.066 1.416 6.167-5.106 12.613-30.71 7.583-36.018 7.204-53.636 12.689-.657.48.758.935 24.164 2.275 10.337.556h25.301l47.114 3.514 12.309 8.139 7.381 9.959-1.238 7.583-18.957 9.655-25.579-6.066-59.702-14.205-20.474-5.106-2.83-.001v1.694l17.061 16.682 31.266 28.233 39.152 36.397 1.997 8.999-5.03 7.102-5.307-.758-34.401-25.883-13.27-11.651-30.053-25.302-1.996-.001v2.654l6.926 10.136 36.574 54.975 1.895 16.859-2.653 5.485-9.479 3.311-10.414-1.895-21.408-30.054-22.092-33.844-17.819-30.331-2.173 1.238-10.515 113.261-4.929 5.788-11.374 4.348-9.478-7.204-5.03-11.652 5.03-23.027 6.066-30.052 4.928-23.886 4.449-29.674 2.654-9.858-.177-.657-2.173.278-22.37 30.71-34.021 45.977-26.919 28.815-6.445 2.553-11.173-5.789 1.037-10.337 6.243-9.2 37.257-47.392 22.47-29.371 14.508-16.961-.101-2.451h-.859l-98.954 64.251-17.618 2.275-7.583-7.103.936-11.652 3.589-3.791 29.749-20.474-.101.102.024.101z" />
                        </svg>
                    </button>
                    <button onclick="openAI('beats', 'grok')" class="ai-btn" title="Ask Grok">
                        <svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision"
                            text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd"
                            clip-rule="evenodd" viewBox="0 0 512 509.641">
                            <path
                                d="M115.612 0h280.776C459.975 0 512 52.026 512 115.612v278.416c0 63.587-52.025 115.613-115.612 115.613H115.612C52.026 509.641 0 457.615 0 394.028V115.612C0 52.026 52.026 0 115.612 0z" />
                            <path fill="#fff"
                                d="M213.235 306.019l178.976-180.002v.169l51.695-51.763c-.924 1.32-1.86 2.605-2.785 3.89-39.281 54.164-58.46 80.649-43.07 146.922l-.09-.101c10.61 45.11-.744 95.137-37.398 131.836-46.216 46.306-120.167 56.611-181.063 14.928l42.462-19.675c38.863 15.278 81.392 8.57 111.947-22.03 30.566-30.6 37.432-75.159 22.065-112.252-2.92-7.025-11.67-8.795-17.792-4.263l-124.947 92.341zm-25.786 22.437l-.033.034L68.094 435.217c7.565-10.429 16.957-20.294 26.327-30.149 26.428-27.803 52.653-55.359 36.654-94.302-21.422-52.112-8.952-113.177 30.724-152.898 41.243-41.254 101.98-51.661 152.706-30.758 11.23 4.172 21.016 10.114 28.638 15.639l-42.359 19.584c-39.44-16.563-84.629-5.299-112.207 22.313-37.298 37.308-44.84 102.003-1.128 143.81z" />
                        </svg>
                    </button>
                </div>
                <div class="sim-controls">
                    <div class="slider-group">
                        <label>Freq Difference ($\Delta f$) <span id="val-beat">0.5</span> Hz</label>
                        <input type="range" id="input-beat" min="0.1" max="2.0" step="0.1" value="0.5">
                    </div>
                </div>
            </div>
            <div class="visual-col">
                <canvas id="canvas-beats"></canvas>
            </div>
        </div>
    </section>

    <section class="references">
        <div style="max-width: 800px; margin: 0 auto;">
            <h3>Academic References</h3>
            <ul>
                <li><strong>Young, H. D., & Freedman, R. A.</strong> (2015). <em>University Physics with Modern
                        Physics</em>, Chapter 15.</li>
                <li><strong>Hecht, E.</strong> <em>Optics</em>, Section 9.1.</li>
            </ul>
        </div>
    </section>

    <!-- Scripts -->
    <script src="../js/common.js"></script>
    <script>
        // ------------------------------------------------------------------
        // AI LINKS HANDLER
        // ------------------------------------------------------------------
        function openAI(topic, model) {
            let prompt = "";
            switch (topic) {
                case 'superposition':
                    prompt = "Explain the principle of wave superposition in physics to a beginner. Use analogies like an orchestra.";
                    break;
                case 'interference':
                    prompt = "How does active noise cancellation use destructive interference? Explain the physics behind it.";
                    break;
                case 'beats':
                    prompt = "Explain the physics of beat frequencies and how musicians use them for tuning instruments.";
                    break;
            }
            const encoded = encodeURIComponent(prompt);

            if (model === 'gemini') {
                navigator.clipboard.writeText(prompt).then(() => {
                    alert("Gemini doesn't support auto-fill. The prompt has been copied to your clipboard.");
                    window.open('https://gemini.google.com/app', '_blank');
                });
                return;
            }

            let url = "";
            switch (model) {
                case 'perplexity': url = `https://www.perplexity.ai/search?q=${encoded}`; break;
                case 'chatgpt': url = `https://chatgpt.com/?q=${encoded}`; break;
                case 'claude': url = `https://claude.ai/new?q=${encoded}`; break;
                case 'grok': url = `https://grok.com/?q=${encoded}`; break;
            }
            if (url) window.open(url, '_blank');
        }

        // ------------------------------------------------------------------
        // AUDIO CONTROLLER
        // ------------------------------------------------------------------
        const Audio = {
            ctx: null,
            masterGain: null,
            nodes: {},
            isEnabled: false,

            init() {
                if (!this.ctx) {
                    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                    this.masterGain = this.ctx.createGain();
                    this.masterGain.gain.value = 0; // Start muted
                    this.masterGain.connect(this.ctx.destination);
                }
            },

            toggle() {
                this.init();
                this.isEnabled = !this.isEnabled;
                const btn = document.getElementById('audioBtn');
                const icon = btn.querySelector('i');

                if (this.isEnabled) {
                    this.ctx.resume();
                    this.masterGain.gain.setTargetAtTime(0.1, this.ctx.currentTime, 0.1);
                    btn.innerHTML = '<i data-lucide="volume-2" width="16"></i>';
                    lucide.createIcons();
                } else {
                    this.masterGain.gain.setTargetAtTime(0, this.ctx.currentTime, 0.1);
                    btn.innerHTML = '<i data-lucide="volume-x" width="16"></i>';
                    lucide.createIcons();
                }
            },

            // INTERFERENCE: 2 Oscillators with delay (phase)
            updateInterference(phaseDegrees) {
                if (!this.ctx) return;
                const id = 'interference';

                // Init nodes if needed
                if (!this.nodes[id]) {
                    const osc1 = this.ctx.createOscillator();
                    const osc2 = this.ctx.createOscillator();
                    const delay = this.ctx.createDelay();
                    const gain = this.ctx.createGain();

                    osc1.frequency.value = 220; // A3
                    osc2.frequency.value = 220;
                    osc1.type = 'sine';
                    osc2.type = 'sine';

                    osc1.connect(gain);
                    osc2.connect(delay);
                    delay.connect(gain);
                    gain.connect(this.masterGain);

                    osc1.start();
                    osc2.start();

                    this.nodes[id] = { osc1, osc2, delay, gain };
                }

                // Phase math: t = (phi / 360) * (1 / freq)
                const freq = 220;
                const period = 1 / freq;
                const delayTime = (phaseDegrees / 360) * period;
                this.nodes[id].delay.delayTime.setTargetAtTime(delayTime, this.ctx.currentTime, 0.05);
            },

            // BEATS: 2 Oscillators with slightly diff freq
            updateBeats(df) {
                if (!this.ctx) return;
                const id = 'beats';

                if (!this.nodes[id]) {
                    const osc1 = this.ctx.createOscillator();
                    const osc2 = this.ctx.createOscillator();
                    const gain = this.ctx.createGain();

                    // Base freq
                    const f = 300;
                    osc1.frequency.value = f;
                    osc1.type = 'triangle'; // Richer sound for beats
                    osc2.type = 'triangle';

                    osc1.connect(gain);
                    osc2.connect(gain);
                    gain.connect(this.masterGain);

                    osc1.start();
                    osc2.start();

                    this.nodes[id] = { osc1, osc2, gain, f };
                }

                const base = this.nodes[id].f;
                this.nodes[id].osc2.frequency.setTargetAtTime(base + df, this.ctx.currentTime, 0.05);
            },

            stopAll() {
                if (this.masterGain) this.masterGain.gain.setValueAtTime(0, this.ctx.currentTime);
                // In a real app we might disconnect/stop nodes to save CPU, 
                // but for this demo keeping them running muted is fine.
            }
        };

        const APP = {
            visuals: [],
            observer: null,

            init() {
                this.setupObserver();
                this.initScrollAnimations();
                this.initVisuals();
                this.setupAudioUI();

                window.addEventListener('theme-changed', (e) => {
                    this.visuals.forEach(v => v.updateColors());
                });
            },

            setupAudioUI() {
                document.getElementById('audioBtn').addEventListener('click', () => {
                    Audio.toggle();
                });
            },


            setupObserver() {
                this.observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        const visual = this.visuals.find(v => v.canvas === entry.target);
                        if (visual) {
                            visual.isVisible = entry.isIntersecting;
                            // Mute audio if visual scrolls out of view
                            if (visual.hasAudio && !entry.isIntersecting) {
                                // Specific logic could go here, but master gain is global.
                                // Ideal: Adjust individual node gains based on visibility.
                                // For simplicity: We keep them running, user toggles audio globally.
                                // Actually, let's auto-mute invisible visuals to avoid chaos.
                                if (Audio.nodes[visual.audioId]) {
                                    Audio.nodes[visual.audioId].gain.gain.setTargetAtTime(0, Audio.ctx.currentTime, 0.5);
                                }
                            } else if (visual.hasAudio && entry.isIntersecting && Audio.isEnabled) {
                                if (Audio.nodes[visual.audioId]) {
                                    Audio.nodes[visual.audioId].gain.gain.setTargetAtTime(1, Audio.ctx.currentTime, 0.5);
                                }
                            }
                        }
                    });
                }, { threshold: 0.1 });
            },

            initScrollAnimations() {
                gsap.registerPlugin(ScrollTrigger);
                gsap.utils.toArray('h1, h2, h3').forEach(el => {
                    gsap.from(el, { opacity: 0, y: 30, duration: 1.2, ease: "power3.out", scrollTrigger: { trigger: el, start: "top 85%" } });
                });
                gsap.utils.toArray('.math-block').forEach(el => {
                    gsap.from(el, { scale: 0.95, opacity: 0, duration: 1, ease: "power2.out", scrollTrigger: { trigger: el, start: "top 90%" } });
                });
            },

            initVisuals() {
                this.addVisual(new SuperpositionVisual('canvas-superposition'));
                this.addVisual(new InterferenceVisual('canvas-interference'));
                this.addVisual(new BeatsVisual('canvas-beats'));
            },

            addVisual(visual) {
                this.visuals.push(visual);
                this.observer.observe(visual.canvas);
            }
        };

        class BaseVisual {
            constructor(id) {
                this.canvas = document.getElementById(id);
                this.ctx = this.canvas.getContext('2d');
                this.isVisible = false;
                this.updateColors();
                this.resize();
                window.addEventListener('resize', () => this.resize());
                this.loop();
            }
            updateColors() {
                this.color = getComputedStyle(document.body).getPropertyValue('--text-main').trim();
                this.bg = getComputedStyle(document.body).getPropertyValue('--bg-color').trim();
                this.accent = getComputedStyle(document.body).getPropertyValue('--accent').trim();
                this.secondary = getComputedStyle(document.body).getPropertyValue('--accent-secondary').trim();
                this.muted = 'rgba(128,128,128, 0.4)';
            }
            resize() {
                const rect = this.canvas.parentElement.getBoundingClientRect();
                this.canvas.width = rect.width * 2;
                this.canvas.height = rect.height * 2;
                this.scale = 2;
                this.cx = this.canvas.width / 2;
                this.cy = this.canvas.height / 2;
            }
            loop() {
                if (this.isVisible) this.draw();
                requestAnimationFrame(() => this.loop());
            }
            draw() { }
        }

        class SuperpositionVisual extends BaseVisual {
            constructor(id) { super(id); this.time = 0; }
            draw() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.time += 0.02;

                // Wave parameters
                const k = 0.05; // Wave number
                const w = 0.1;  // Angular freq
                const amp = 40 * this.scale;

                this.ctx.lineWidth = 2 * this.scale;

                // Draw component 1 (Traveling Right)
                this.ctx.strokeStyle = this.muted;
                this.ctx.beginPath();
                for (let x = 0; x < this.canvas.width; x += 5) {
                    const y = this.cy + Math.sin(x * k * 0.5 - this.time * 2) * amp;
                    if (x === 0) this.ctx.moveTo(x, y); else this.ctx.lineTo(x, y);
                }
                this.ctx.stroke();

                // Draw component 2 (Traveling Left)
                this.ctx.strokeStyle = this.muted;
                this.ctx.beginPath();
                for (let x = 0; x < this.canvas.width; x += 5) {
                    const y = this.cy + Math.sin(x * k * 0.5 + this.time * 2) * amp;
                    if (x === 0) this.ctx.moveTo(x, y); else this.ctx.lineTo(x, y);
                }
                this.ctx.stroke();

                // Draw Resultant
                this.ctx.strokeStyle = this.accent;
                this.ctx.lineWidth = 3 * this.scale;
                this.ctx.beginPath();
                for (let x = 0; x < this.canvas.width; x += 5) {
                    const y1 = Math.sin(x * k * 0.5 - this.time * 2) * amp;
                    const y2 = Math.sin(x * k * 0.5 + this.time * 2) * amp;
                    const y = this.cy + y1 + y2;
                    if (x === 0) this.ctx.moveTo(x, y); else this.ctx.lineTo(x, y);
                }
                this.ctx.stroke();

                // Label
                this.ctx.fillStyle = this.color;
                this.ctx.font = `14px Inter`;
                this.ctx.fillText("y1 (Right)", 20, 40);
                this.ctx.fillText("y2 (Left)", 20, 60);
                this.ctx.fillStyle = this.accent;
                this.ctx.fillText("Resultant", 20, 80);
            }
        }

        class InterferenceVisual extends BaseVisual {
            constructor(id) {
                super(id);
                this.time = 0;
                this.phase = 0;
                const input = document.getElementById('input-phase');
                input.addEventListener('input', (e) => {
                    this.phase = parseFloat(e.target.value) * (Math.PI / 180);
                    document.getElementById('val-phase').innerText = e.target.value;
                    if (Audio && Audio.updateInterference) Audio.updateInterference(parseFloat(e.target.value));
                });

                this.hasAudio = true;
                this.audioId = 'interference';
                if (Audio && Audio.updateInterference) Audio.updateInterference(this.phase);
            }
            draw() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.time += 0.05;

                const amp = 40 * this.scale;
                const freq = 0.02;

                // Reference Wave (Stationary phase relative to shift)
                this.ctx.strokeStyle = this.muted;
                this.ctx.lineWidth = 2 * this.scale;
                this.ctx.setLineDash([5, 5]);
                this.ctx.beginPath();
                for (let x = 0; x < this.canvas.width; x += 5) {
                    const y = this.cy + Math.sin(x * freq + this.time) * amp;
                    if (x === 0) this.ctx.moveTo(x, y); else this.ctx.lineTo(x, y);
                }
                this.ctx.stroke();

                // Shifted Wave
                this.ctx.strokeStyle = this.muted;
                this.ctx.beginPath();
                for (let x = 0; x < this.canvas.width; x += 5) {
                    const y = this.cy + Math.sin(x * freq + this.time + this.phase) * amp;
                    if (x === 0) this.ctx.moveTo(x, y); else this.ctx.lineTo(x, y);
                }
                this.ctx.stroke();
                this.ctx.setLineDash([]);

                // Resultant
                this.ctx.strokeStyle = this.secondary;
                this.ctx.lineWidth = 3 * this.scale;
                this.ctx.beginPath();
                for (let x = 0; x < this.canvas.width; x += 5) {
                    const y1 = Math.sin(x * freq + this.time) * amp;
                    const y2 = Math.sin(x * freq + this.time + this.phase) * amp;
                    const y = this.cy + (y1 + y2);
                    if (x === 0) this.ctx.moveTo(x, y); else this.ctx.lineTo(x, y);
                }
                this.ctx.stroke();
            }
        }

        class BeatsVisual extends BaseVisual {
            constructor(id) {
                super(id);
                this.time = 0;
                this.df = 0.5;
                const input = document.getElementById('input-beat');
                input.addEventListener('input', (e) => {
                    this.df = parseFloat(e.target.value);
                    document.getElementById('val-beat').innerText = this.df;
                    if (Audio && Audio.updateBeats) Audio.updateBeats(this.df);
                });

                this.hasAudio = true;
                this.audioId = 'beats';
                if (Audio && Audio.updateBeats) Audio.updateBeats(this.df);
            }
            draw() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.time += 0.02;

                const amp = 30 * this.scale;
                const f1 = 0.1;
                const f2 = f1 + (this.df * 0.02); // Scale df for visual

                // Resultant only for clarity
                this.ctx.strokeStyle = this.color;
                this.ctx.lineWidth = 2 * this.scale;
                this.ctx.beginPath();

                // Draw envelope? No just the wave
                for (let x = 0; x < this.canvas.width; x += 2) {
                    // Two sources at x=0, propagating right?
                    // Let's do temporal beats at a point, but mapped to x for viz?
                    // Better: Spatial snapshot of two waves with slightly diff spatial freq

                    const k1 = 0.1;
                    const k2 = k1 + (this.df * 0.02);

                    const y1 = Math.sin(x * k1 - this.time * 5) * amp;
                    const y2 = Math.sin(x * k2 - this.time * 5) * amp;

                    const y = this.cy + (y1 + y2);
                    if (x === 0) this.ctx.moveTo(x, y); else this.ctx.lineTo(x, y);
                }
                this.ctx.stroke();

                // Draw Envelope (approx)
                this.ctx.strokeStyle = this.accent;
                this.ctx.lineWidth = 1 * this.scale;
                this.ctx.globalAlpha = 0.5;
                // Envelope frequency is difference
                // A_env = 2A cos((k1-k2)x/2 ...)
                this.ctx.beginPath();
                const dk = (this.df * 0.02);
                for (let x = 0; x < this.canvas.width; x += 5) {
                    const env = 2 * amp * Math.cos(x * dk / 2); // Phase part omitted for envelope static shape
                    // actually envelope moves too. 
                    // Let's just draw the wave, it's self explanatory visually
                }
                // this.ctx.stroke();
                this.ctx.globalAlpha = 1;

            }
        }

        window.onload = () => APP.init();

    </script>
</body>

</html>