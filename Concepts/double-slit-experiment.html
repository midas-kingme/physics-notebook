<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Double Slit Experiment • Physics Notebook</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/article.css">
    <style>
        /* AI Links */
        .ai-links {
            display: flex;
            gap: 0.8rem;
            margin-top: 1rem;
            align-items: center;
        }

        .ai-label {
            font-size: 0.8rem;
            opacity: 0.6;
            margin-right: 0.2rem;
            font-weight: 500;
        }

        .ai-btn {
            background: var(--bg-color);
            border: 1px solid var(--line-subtle);
            color: var(--text-muted);
            min-width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 0 8px;
        }

        .ai-btn svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--line-subtle);
            transition: 0.3s;
            border-radius: 26px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle-switch input:checked+.toggle-slider {
            background-color: var(--accent);
        }

        .toggle-switch input:checked+.toggle-slider:before {
            transform: translateX(24px);
        }
    </style>

    <!-- MathJax Configuration -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Theme Init -->
    <script>
        const savedTheme = localStorage.getItem('physics-notebook-theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        document.body && document.body.setAttribute('data-theme', savedTheme);
    </script>

    <!-- Libs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>
    <nav class="sticky">
        <div class="nav-bg"></div>
        <a href="../index.html" class="logo">
            <i data-lucide="arrow-left" width="16"></i>
            Library
        </a>
        <button id="themeBtn">
            <i data-lucide="moon" width="16"></i> Theme
        </button>
    </nav>

    <!-- HERO -->
    <section class="hero">
        <div class="text-reveal-wrapper">
            <h1 class="hero-title">The Double Slit<br>Experiment</h1>
            <p style="margin-top: 2rem; font-size: 1.4rem; max-width: 40ch;">
                The experiment that revealed the wave-particle duality at the heart of quantum mechanics.
            </p>
        </div>
    </section>

    <!-- SECTION 1: Classical Wave Behavior -->
    <section>
        <div class="split-layout">
            <div class="content-col">
                <h3 class="section-label" style="color: var(--accent);">01. Classical Waves</h3>
                <h2>Interference Patterns</h2>
                <p>
                    When waves pass through two slits, they create an <strong>interference pattern</strong>.
                    Regions where crests meet crests produce bright fringes (constructive interference),
                    while crests meeting troughs create dark fringes (destructive interference).
                </p>
                <div class="math-block">
                    $$d \sin\theta = m\lambda \quad \text{(constructive, } m = 0, \pm1, \pm2, \ldots\text{)}$$
                </div>
                <p>
                    Here, $d$ is the slit separation, $\theta$ is the angle to the fringe,
                    $\lambda$ is the wavelength, and $m$ is the order number.
                </p>

                <div class="etu-card">
                    <span class="etu-tag">Real World Analogy</span>
                    <h4 style="margin-bottom:0.5rem;">Ripples on a Pond</h4>
                    <p style="font-size: 0.95rem; margin-bottom:0;">
                        Drop two pebbles in a calm pond. The circular ripples overlap, creating regions
                        where the water is calm (destructive) and regions where waves are amplified (constructive).
                    </p>
                </div>

                <div class="ai-links">
                    <span class="ai-label">Ask AI:</span>
                    <button onclick="openAI('classical', 'perplexity')" class="ai-btn" title="Ask Perplexity">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M22.3977 7.0896h-2.3106V.0676l-7.5094 6.3542V.1577h-1.1554v6.1966L4.4904 0v7.0896H1.6023v10.3976h2.8882V24l6.932-6.3591v6.2005h1.1554v-6.0469l6.9318 6.1807v-6.4879h2.8882V7.0896zm-3.4657-4.531v4.531h-5.355l5.355-4.531zm-13.2862.0676 4.8691 4.4634H5.6458V2.6262zM2.7576 16.332V8.245h7.8476l-6.1149 6.1147v1.9723H2.7576zm2.8882 5.0404v-3.8852h.0001v-2.6488l5.7763-5.7764v7.0111l-5.7764 5.2993zm12.7086.0248-5.7766-5.1509V9.0618l5.7766 5.7766v6.5588zm2.8882-5.0652h-1.733v-1.9723L13.3948 8.245h7.8478v8.087z" />
                        </svg>
                    </button>
                    <button onclick="openAI('classical', 'gemini')" class="ai-btn" title="Ask Gemini">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M11.04 19.32Q12 21.51 12 24q0-2.49.93-4.68.96-2.19 2.58-3.81t3.81-2.55Q21.51 12 24 12q-2.49 0-4.68-.93a12.3 12.3 0 0 1-3.81-2.58 12.3 12.3 0 0 1-2.58-3.81Q12 2.49 12 0q0 2.49-.96 4.68-.93 2.19-2.55 3.81a12.3 12.3 0 0 1-3.81 2.58Q2.49 12 0 12q2.49 0 4.68.96 2.19.93 3.81 2.55t2.55 3.81" />
                        </svg>
                    </button>
                    <button onclick="openAI('classical', 'chatgpt')" class="ai-btn" title="Ask ChatGPT">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M22.2819 9.8211a5.9847 5.9847 0 0 0-.5157-4.9108 6.0462 6.0462 0 0 0-6.5098-2.9A6.0651 6.0651 0 0 0 4.9807 4.1818a5.9847 5.9847 0 0 0-3.9977 2.9 6.0462 6.0462 0 0 0 .7427 7.0966 5.98 5.98 0 0 0 .511 4.9107 6.051 6.051 0 0 0 6.5146 2.9001A5.9847 5.9847 0 0 0 13.2599 24a6.0557 6.0557 0 0 0 5.7718-4.2058 5.9894 5.9894 0 0 0 3.9977-2.9001 6.0557 6.0557 0 0 0-.7475-7.0729zm-9.022 12.6081a4.4755 4.4755 0 0 1-2.8764-1.0408l.1419-.0804 4.7783-2.7582a.7948.7948 0 0 0 .3927-.6813v-6.7369l2.02 1.1686a.071.071 0 0 1 .038.052v5.5826a4.504 4.504 0 0 1-4.4945 4.4944zm-9.6607-4.1254a4.4708 4.4708 0 0 1-.5346-3.0137l.142.0852 4.783 2.7582a.7712.7712 0 0 0 .7806 0l5.8428-3.3685v2.3324a.0804.0804 0 0 1-.0332.0615L9.74 19.9502a4.4992 4.4992 0 0 1-6.1408-1.6464zM2.3408 7.8956a4.485 4.485 0 0 1 2.3655-1.9728V11.6a.7664.7664 0 0 0 .3879.6765l5.8144 3.3543-2.0201 1.1685a.0757.0757 0 0 1-.071 0l-4.8303-2.7865A4.504 4.504 0 0 1 2.3408 7.872zm16.5963 3.8558L13.1038 8.364 15.1192 7.2a.0757.0757 0 0 1 .071 0l4.8303 2.7913a4.4944 4.4944 0 0 1-.6765 8.1042v-5.6772a.79.79 0 0 0-.407-.667zm2.0107-3.0231l-.142-.0852-4.7735-2.7818a.7759.7759 0 0 0-.7854 0L9.409 9.2297V6.8974a.0662.0662 0 0 1 .0284-.0615l4.8303-2.7866a4.4992 4.4992 0 0 1 6.6802 4.66zM8.3065 12.863l-2.02-1.1638a.0804.0804 0 0 1-.038-.0567V6.0742a4.4992 4.4992 0 0 1 7.3757-3.4537l-.142.0805L8.704 5.459a.7948.7948 0 0 0-.3927.6813zm1.0976-2.3654l2.602-1.4998 2.6069 1.4998v2.9994l-2.5974 1.4997-2.6067-1.4997Z" />
                        </svg>
                    </button>
                    <button onclick="openAI('classical', 'claude')" class="ai-btn" title="Ask Claude">
                        <svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision"
                            text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd"
                            clip-rule="evenodd" viewBox="0 0 512 509.64">
                            <path fill="#D77655"
                                d="M115.612 0h280.775C459.974 0 512 52.026 512 115.612v278.415c0 63.587-52.026 115.612-115.613 115.612H115.612C52.026 509.639 0 457.614 0 394.027V115.612C0 52.026 52.026 0 115.612 0z" />
                            <path fill="#FCF2EE" fill-rule="nonzero"
                                d="M142.27 316.619l73.655-41.326 1.238-3.589-1.238-1.996-3.589-.001-12.31-.759-42.084-1.138-36.498-1.516-35.361-1.896-8.897-1.895-8.34-10.995.859-5.484 7.482-5.03 10.717.935 23.683 1.617 35.537 2.452 25.782 1.517 38.193 3.968h6.064l.86-2.451-2.073-1.517-1.618-1.517-36.776-24.922-39.81-26.338-20.852-15.166-11.273-7.683-5.687-7.204-2.451-15.721 10.237-11.273 13.75.935 3.513.936 13.928 10.716 29.749 23.027 38.848 28.612 5.687 4.727 2.275-1.617.278-1.138-2.553-4.271-21.13-38.193-22.546-38.848-10.035-16.101-2.654-9.655c-.935-3.968-1.617-7.304-1.617-11.374l11.652-15.823 6.445-2.073 15.545 2.073 6.547 5.687 9.655 22.092 15.646 34.78 24.265 47.291 7.103 14.028 3.791 12.992 1.416 3.968 2.449-.001v-2.275l1.997-26.641 3.69-32.707 3.589-42.084 1.239-11.854 5.863-14.206 11.652-7.683 9.099 4.348 7.482 10.716-1.036 6.926-4.449 28.915-8.72 45.294-5.687 30.331h3.313l3.792-3.791 15.342-20.372 25.782-32.227 11.374-12.789 13.27-14.129 8.517-6.724 16.1-.001 11.854 17.617-5.307 18.199-16.581 21.029-13.75 17.819-19.716 26.54-12.309 21.231 1.138 1.694 2.932-.278 44.536-9.479 24.062-4.347 28.714-4.928 12.992 6.066 1.416 6.167-5.106 12.613-30.71 7.583-36.018 7.204-53.636 12.689-.657.48.758.935 24.164 2.275 10.337.556h25.301l47.114 3.514 12.309 8.139 7.381 9.959-1.238 7.583-18.957 9.655-25.579-6.066-59.702-14.205-20.474-5.106-2.83-.001v1.694l17.061 16.682 31.266 28.233 39.152 36.397 1.997 8.999-5.03 7.102-5.307-.758-34.401-25.883-13.27-11.651-30.053-25.302-1.996-.001v2.654l6.926 10.136 36.574 54.975 1.895 16.859-2.653 5.485-9.479 3.311-10.414-1.895-21.408-30.054-22.092-33.844-17.819-30.331-2.173 1.238-10.515 113.261-4.929 5.788-11.374 4.348-9.478-7.204-5.03-11.652 5.03-23.027 6.066-30.052 4.928-23.886 4.449-29.674 2.654-9.858-.177-.657-2.173.278-22.37 30.71-34.021 45.977-26.919 28.815-6.445 2.553-11.173-5.789 1.037-10.337 6.243-9.2 37.257-47.392 22.47-29.371 14.508-16.961-.101-2.451h-.859l-98.954 64.251-17.618 2.275-7.583-7.103.936-11.652 3.589-3.791 29.749-20.474-.101.102.024.101z" />
                        </svg>
                    </button>
                    <button onclick="openAI('classical', 'grok')" class="ai-btn" title="Ask Grok">
                        <svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision"
                            text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd"
                            clip-rule="evenodd" viewBox="0 0 512 509.641">
                            <path
                                d="M115.612 0h280.776C459.975 0 512 52.026 512 115.612v278.416c0 63.587-52.025 115.613-115.612 115.613H115.612C52.026 509.641 0 457.615 0 394.028V115.612C0 52.026 52.026 0 115.612 0z" />
                            <path fill="#fff"
                                d="M213.235 306.019l178.976-180.002v.169l51.695-51.763c-.924 1.32-1.86 2.605-2.785 3.89-39.281 54.164-58.46 80.649-43.07 146.922l-.09-.101c10.61 45.11-.744 95.137-37.398 131.836-46.216 46.306-120.167 56.611-181.063 14.928l42.462-19.675c38.863 15.278 81.392 8.57 111.947-22.03 30.566-30.6 37.432-75.159 22.065-112.252-2.92-7.025-11.67-8.795-17.792-4.263l-124.947 92.341zm-25.786 22.437l-.033.034L68.094 435.217c7.565-10.429 16.957-20.294 26.327-30.149 26.428-27.803 52.653-55.359 36.654-94.302-21.422-52.112-8.952-113.177 30.724-152.898 41.243-41.254 101.98-51.661 152.706-30.758 11.23 4.172 21.016 10.114 28.638 15.639l-42.359 19.584c-39.44-16.563-84.629-5.299-112.207 22.313-37.298 37.308-44.84 102.003-1.128 143.81z" />
                        </svg>
                    </button>
                </div>
                <div class="sim-controls">
                    <div class="slider-group">
                        <label>Wavelength ($\lambda$) <span id="val-wavelength">1.0</span></label>
                        <input type="range" id="input-wavelength" min="0.5" max="2.0" step="0.1" value="1.0">
                    </div>
                    <div class="slider-group">
                        <label>Slit Separation ($d$) <span id="val-slit-sep">1.0</span></label>
                        <input type="range" id="input-slit-sep" min="0.5" max="2.0" step="0.1" value="1.0">
                    </div>
                </div>
            </div>
            <div class="visual-col">
                <canvas id="canvas-classical"></canvas>
            </div>
        </div>
    </section>

    <div class="divider"></div>

    <!-- SECTION 2: Quantum Behavior -->
    <section>
        <div class="split-layout">
            <div class="content-col">
                <h3 class="section-label" style="color: var(--accent-secondary);">02. The Quantum Twist</h3>
                <h2>Photons & Electrons</h2>
                <p>
                    When we send <strong>individual photons or electrons</strong> through the double slit one at a time,
                    each particle creates a single dot on the detector. But over time, these dots accumulate into
                    the same interference pattern—as if each particle "interferes with itself."
                </p>
                <p>
                    This challenges our classical intuition: How can a single particle go through both slits
                    simultaneously?
                </p>
                <div class="math-block">
                    $$|\Psi\rangle = \frac{1}{\sqrt{2}}\left(|\text{slit}_1\rangle + |\text{slit}_2\rangle\right)$$
                </div>

                <div class="etu-card">
                    <span class="etu-tag">Deep Concept</span>
                    <h4 style="margin-bottom:0.5rem;">Superposition</h4>
                    <p style="font-size: 0.95rem; margin-bottom:0;">
                        Until measured, the particle exists in a superposition—simultaneously taking both paths.
                        The act of measurement collapses this superposition to a definite state.
                    </p>
                </div>

                <div class="ai-links">
                    <span class="ai-label">Ask AI:</span>
                    <button onclick="openAI('quantum', 'perplexity')" class="ai-btn" title="Ask Perplexity">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M22.3977 7.0896h-2.3106V.0676l-7.5094 6.3542V.1577h-1.1554v6.1966L4.4904 0v7.0896H1.6023v10.3976h2.8882V24l6.932-6.3591v6.2005h1.1554v-6.0469l6.9318 6.1807v-6.4879h2.8882V7.0896zm-3.4657-4.531v4.531h-5.355l5.355-4.531zm-13.2862.0676 4.8691 4.4634H5.6458V2.6262zM2.7576 16.332V8.245h7.8476l-6.1149 6.1147v1.9723H2.7576zm2.8882 5.0404v-3.8852h.0001v-2.6488l5.7763-5.7764v7.0111l-5.7764 5.2993zm12.7086.0248-5.7766-5.1509V9.0618l5.7766 5.7766v6.5588zm2.8882-5.0652h-1.733v-1.9723L13.3948 8.245h7.8478v8.087z" />
                        </svg>
                    </button>
                    <button onclick="openAI('quantum', 'gemini')" class="ai-btn" title="Ask Gemini">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M11.04 19.32Q12 21.51 12 24q0-2.49.93-4.68.96-2.19 2.58-3.81t3.81-2.55Q21.51 12 24 12q-2.49 0-4.68-.93a12.3 12.3 0 0 1-3.81-2.58 12.3 12.3 0 0 1-2.58-3.81Q12 2.49 12 0q0 2.49-.96 4.68-.93 2.19-2.55 3.81a12.3 12.3 0 0 1-3.81 2.58Q2.49 12 0 12q2.49 0 4.68.96 2.19.93 3.81 2.55t2.55 3.81" />
                        </svg>
                    </button>
                    <button onclick="openAI('quantum', 'chatgpt')" class="ai-btn" title="Ask ChatGPT">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M22.2819 9.8211a5.9847 5.9847 0 0 0-.5157-4.9108 6.0462 6.0462 0 0 0-6.5098-2.9A6.0651 6.0651 0 0 0 4.9807 4.1818a5.9847 5.9847 0 0 0-3.9977 2.9 6.0462 6.0462 0 0 0 .7427 7.0966 5.98 5.98 0 0 0 .511 4.9107 6.051 6.051 0 0 0 6.5146 2.9001A5.9847 5.9847 0 0 0 13.2599 24a6.0557 6.0557 0 0 0 5.7718-4.2058 5.9894 5.9894 0 0 0 3.9977-2.9001 6.0557 6.0557 0 0 0-.7475-7.0729zm-9.022 12.6081a4.4755 4.4755 0 0 1-2.8764-1.0408l.1419-.0804 4.7783-2.7582a.7948.7948 0 0 0 .3927-.6813v-6.7369l2.02 1.1686a.071.071 0 0 1 .038.052v5.5826a4.504 4.504 0 0 1-4.4945 4.4944zm-9.6607-4.1254a4.4708 4.4708 0 0 1-.5346-3.0137l.142.0852 4.783 2.7582a.7712.7712 0 0 0 .7806 0l5.8428-3.3685v2.3324a.0804.0804 0 0 1-.0332.0615L9.74 19.9502a4.4992 4.4992 0 0 1-6.1408-1.6464zM2.3408 7.8956a4.485 4.485 0 0 1 2.3655-1.9728V11.6a.7664.7664 0 0 0 .3879.6765l5.8144 3.3543-2.0201 1.1685a.0757.0757 0 0 1-.071 0l-4.8303-2.7865A4.504 4.504 0 0 1 2.3408 7.872zm16.5963 3.8558L13.1038 8.364 15.1192 7.2a.0757.0757 0 0 1 .071 0l4.8303 2.7913a4.4944 4.4944 0 0 1-.6765 8.1042v-5.6772a.79.79 0 0 0-.407-.667zm2.0107-3.0231l-.142-.0852-4.7735-2.7818a.7759.7759 0 0 0-.7854 0L9.409 9.2297V6.8974a.0662.0662 0 0 1 .0284-.0615l4.8303-2.7866a4.4992 4.4992 0 0 1 6.6802 4.66zM8.3065 12.863l-2.02-1.1638a.0804.0804 0 0 1-.038-.0567V6.0742a4.4992 4.4992 0 0 1 7.3757-3.4537l-.142.0805L8.704 5.459a.7948.7948 0 0 0-.3927.6813zm1.0976-2.3654l2.602-1.4998 2.6069 1.4998v2.9994l-2.5974 1.4997-2.6067-1.4997Z" />
                        </svg>
                    </button>
                    <button onclick="openAI('quantum', 'claude')" class="ai-btn" title="Ask Claude">
                        <svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision"
                            text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd"
                            clip-rule="evenodd" viewBox="0 0 512 509.64">
                            <path fill="#D77655"
                                d="M115.612 0h280.775C459.974 0 512 52.026 512 115.612v278.415c0 63.587-52.026 115.612-115.613 115.612H115.612C52.026 509.639 0 457.614 0 394.027V115.612C0 52.026 52.026 0 115.612 0z" />
                            <path fill="#FCF2EE" fill-rule="nonzero"
                                d="M142.27 316.619l73.655-41.326 1.238-3.589-1.238-1.996-3.589-.001-12.31-.759-42.084-1.138-36.498-1.516-35.361-1.896-8.897-1.895-8.34-10.995.859-5.484 7.482-5.03 10.717.935 23.683 1.617 35.537 2.452 25.782 1.517 38.193 3.968h6.064l.86-2.451-2.073-1.517-1.618-1.517-36.776-24.922-39.81-26.338-20.852-15.166-11.273-7.683-5.687-7.204-2.451-15.721 10.237-11.273 13.75.935 3.513.936 13.928 10.716 29.749 23.027 38.848 28.612 5.687 4.727 2.275-1.617.278-1.138-2.553-4.271-21.13-38.193-22.546-38.848-10.035-16.101-2.654-9.655c-.935-3.968-1.617-7.304-1.617-11.374l11.652-15.823 6.445-2.073 15.545 2.073 6.547 5.687 9.655 22.092 15.646 34.78 24.265 47.291 7.103 14.028 3.791 12.992 1.416 3.968 2.449-.001v-2.275l1.997-26.641 3.69-32.707 3.589-42.084 1.239-11.854 5.863-14.206 11.652-7.683 9.099 4.348 7.482 10.716-1.036 6.926-4.449 28.915-8.72 45.294-5.687 30.331h3.313l3.792-3.791 15.342-20.372 25.782-32.227 11.374-12.789 13.27-14.129 8.517-6.724 16.1-.001 11.854 17.617-5.307 18.199-16.581 21.029-13.75 17.819-19.716 26.54-12.309 21.231 1.138 1.694 2.932-.278 44.536-9.479 24.062-4.347 28.714-4.928 12.992 6.066 1.416 6.167-5.106 12.613-30.71 7.583-36.018 7.204-53.636 12.689-.657.48.758.935 24.164 2.275 10.337.556h25.301l47.114 3.514 12.309 8.139 7.381 9.959-1.238 7.583-18.957 9.655-25.579-6.066-59.702-14.205-20.474-5.106-2.83-.001v1.694l17.061 16.682 31.266 28.233 39.152 36.397 1.997 8.999-5.03 7.102-5.307-.758-34.401-25.883-13.27-11.651-30.053-25.302-1.996-.001v2.654l6.926 10.136 36.574 54.975 1.895 16.859-2.653 5.485-9.479 3.311-10.414-1.895-21.408-30.054-22.092-33.844-17.819-30.331-2.173 1.238-10.515 113.261-4.929 5.788-11.374 4.348-9.478-7.204-5.03-11.652 5.03-23.027 6.066-30.052 4.928-23.886 4.449-29.674 2.654-9.858-.177-.657-2.173.278-22.37 30.71-34.021 45.977-26.919 28.815-6.445 2.553-11.173-5.789 1.037-10.337 6.243-9.2 37.257-47.392 22.47-29.371 14.508-16.961-.101-2.451h-.859l-98.954 64.251-17.618 2.275-7.583-7.103.936-11.652 3.589-3.791 29.749-20.474-.101.102.024.101z" />
                        </svg>
                    </button>
                    <button onclick="openAI('quantum', 'grok')" class="ai-btn" title="Ask Grok">
                        <svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision"
                            text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd"
                            clip-rule="evenodd" viewBox="0 0 512 509.641">
                            <path
                                d="M115.612 0h280.776C459.975 0 512 52.026 512 115.612v278.416c0 63.587-52.025 115.613-115.612 115.613H115.612C52.026 509.641 0 457.615 0 394.028V115.612C0 52.026 52.026 0 115.612 0z" />
                            <path fill="#fff"
                                d="M213.235 306.019l178.976-180.002v.169l51.695-51.763c-.924 1.32-1.86 2.605-2.785 3.89-39.281 54.164-58.46 80.649-43.07 146.922l-.09-.101c10.61 45.11-.744 95.137-37.398 131.836-46.216 46.306-120.167 56.611-181.063 14.928l42.462-19.675c38.863 15.278 81.392 8.57 111.947-22.03 30.566-30.6 37.432-75.159 22.065-112.252-2.92-7.025-11.67-8.795-17.792-4.263l-124.947 92.341zm-25.786 22.437l-.033.034L68.094 435.217c7.565-10.429 16.957-20.294 26.327-30.149 26.428-27.803 52.653-55.359 36.654-94.302-21.422-52.112-8.952-113.177 30.724-152.898 41.243-41.254 101.98-51.661 152.706-30.758 11.23 4.172 21.016 10.114 28.638 15.639l-42.359 19.584c-39.44-16.563-84.629-5.299-112.207 22.313-37.298 37.308-44.84 102.003-1.128 143.81z" />
                        </svg>
                    </button>
                </div>
                <div class="sim-controls">
                    <div class="slider-group">
                        <label>Emission Rate <span id="val-emission">10</span> frames</label>
                        <input type="range" id="input-emission" min="3" max="30" step="1" value="10">
                    </div>
                    <div style="margin-top:0.5rem; text-align:right;">
                        <button id="btn-clear-quantum"
                            style="padding:8px 16px; background:var(--text-main); color:var(--bg-color); border:none; border-radius:4px; cursor:pointer;">Clear
                            Pattern</button>
                    </div>
                </div>
            </div>
            <div class="visual-col">
                <canvas id="canvas-quantum"></canvas>
            </div>
        </div>
    </section>

    <div class="divider"></div>

    <!-- SECTION 3: Observer Effect -->
    <section>
        <div class="split-layout">
            <div class="content-col">
                <h3 class="section-label" style="color: var(--text-muted);">03. Measurement</h3>
                <h2>The Observer Effect</h2>
                <p>
                    If we try to determine <strong>which slit</strong> the particle goes through by placing a detector,
                    the interference pattern disappears! The particle suddenly behaves like a classical particle,
                    creating two separate bands instead of an interference pattern.
                </p>
                <p>
                    This demonstrates that <strong>observation fundamentally alters</strong> the quantum system.
                    Measurement collapses the wave function, forcing the particle to "choose" a definite path.
                </p>

                <div class="etu-card">
                    <span class="etu-tag">Philosophical Implication</span>
                    <h4 style="margin-bottom:0.5rem;">Reality and Observation</h4>
                    <p style="font-size: 0.95rem; margin-bottom:0;">
                        The experiment suggests that at the quantum level, reality is not independent of observation.
                        The act of measurement plays an active role in determining the outcome.
                    </p>
                </div>

                <div class="ai-links">
                    <span class="ai-label">Ask AI:</span>
                    <button onclick="openAI('observer', 'perplexity')" class="ai-btn" title="Ask Perplexity">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M22.3977 7.0896h-2.3106V.0676l-7.5094 6.3542V.1577h-1.1554v6.1966L4.4904 0v7.0896H1.6023v10.3976h2.8882V24l6.932-6.3591v6.2005h1.1554v-6.0469l6.9318 6.1807v-6.4879h2.8882V7.0896zm-3.4657-4.531v4.531h-5.355l5.355-4.531zm-13.2862.0676 4.8691 4.4634H5.6458V2.6262zM2.7576 16.332V8.245h7.8476l-6.1149 6.1147v1.9723H2.7576zm2.8882 5.0404v-3.8852h.0001v-2.6488l5.7763-5.7764v7.0111l-5.7764 5.2993zm12.7086.0248-5.7766-5.1509V9.0618l5.7766 5.7766v6.5588zm2.8882-5.0652h-1.733v-1.9723L13.3948 8.245h7.8478v8.087z" />
                        </svg>
                    </button>
                    <button onclick="openAI('observer', 'gemini')" class="ai-btn" title="Ask Gemini">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M11.04 19.32Q12 21.51 12 24q0-2.49.93-4.68.96-2.19 2.58-3.81t3.81-2.55Q21.51 12 24 12q-2.49 0-4.68-.93a12.3 12.3 0 0 1-3.81-2.58 12.3 12.3 0 0 1-2.58-3.81Q12 2.49 12 0q0 2.49-.96 4.68-.93 2.19-2.55 3.81a12.3 12.3 0 0 1-3.81 2.58Q2.49 12 0 12q2.49 0 4.68.96 2.19.93 3.81 2.55t2.55 3.81" />
                        </svg>
                    </button>
                    <button onclick="openAI('observer', 'chatgpt')" class="ai-btn" title="Ask ChatGPT">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M22.2819 9.8211a5.9847 5.9847 0 0 0-.5157-4.9108 6.0462 6.0462 0 0 0-6.5098-2.9A6.0651 6.0651 0 0 0 4.9807 4.1818a5.9847 5.9847 0 0 0-3.9977 2.9 6.0462 6.0462 0 0 0 .7427 7.0966 5.98 5.98 0 0 0 .511 4.9107 6.051 6.051 0 0 0 6.5146 2.9001A5.9847 5.9847 0 0 0 13.2599 24a6.0557 6.0557 0 0 0 5.7718-4.2058 5.9894 5.9894 0 0 0 3.9977-2.9001 6.0557 6.0557 0 0 0-.7475-7.0729zm-9.022 12.6081a4.4755 4.4755 0 0 1-2.8764-1.0408l.1419-.0804 4.7783-2.7582a.7948.7948 0 0 0 .3927-.6813v-6.7369l2.02 1.1686a.071.071 0 0 1 .038.052v5.5826a4.504 4.504 0 0 1-4.4945 4.4944zm-9.6607-4.1254a4.4708 4.4708 0 0 1-.5346-3.0137l.142.0852 4.783 2.7582a.7712.7712 0 0 0 .7806 0l5.8428-3.3685v2.3324a.0804.0804 0 0 1-.0332.0615L9.74 19.9502a4.4992 4.4992 0 0 1-6.1408-1.6464zM2.3408 7.8956a4.485 4.485 0 0 1 2.3655-1.9728V11.6a.7664.7664 0 0 0 .3879.6765l5.8144 3.3543-2.0201 1.1685a.0757.0757 0 0 1-.071 0l-4.8303-2.7865A4.504 4.504 0 0 1 2.3408 7.872zm16.5963 3.8558L13.1038 8.364 15.1192 7.2a.0757.0757 0 0 1 .071 0l4.8303 2.7913a4.4944 4.4944 0 0 1-.6765 8.1042v-5.6772a.79.79 0 0 0-.407-.667zm2.0107-3.0231l-.142-.0852-4.7735-2.7818a.7759.7759 0 0 0-.7854 0L9.409 9.2297V6.8974a.0662.0662 0 0 1 .0284-.0615l4.8303-2.7866a4.4992 4.4992 0 0 1 6.6802 4.66zM8.3065 12.863l-2.02-1.1638a.0804.0804 0 0 1-.038-.0567V6.0742a4.4992 4.4992 0 0 1 7.3757-3.4537l-.142.0805L8.704 5.459a.7948.7948 0 0 0-.3927.6813zm1.0976-2.3654l2.602-1.4998 2.6069 1.4998v2.9994l-2.5974 1.4997-2.6067-1.4997Z" />
                        </svg>
                    </button>
                    <button onclick="openAI('observer', 'claude')" class="ai-btn" title="Ask Claude">
                        <svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision"
                            text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd"
                            clip-rule="evenodd" viewBox="0 0 512 509.64">
                            <path fill="#D77655"
                                d="M115.612 0h280.775C459.974 0 512 52.026 512 115.612v278.415c0 63.587-52.026 115.612-115.613 115.612H115.612C52.026 509.639 0 457.614 0 394.027V115.612C0 52.026 52.026 0 115.612 0z" />
                            <path fill="#FCF2EE" fill-rule="nonzero"
                                d="M142.27 316.619l73.655-41.326 1.238-3.589-1.238-1.996-3.589-.001-12.31-.759-42.084-1.138-36.498-1.516-35.361-1.896-8.897-1.895-8.34-10.995.859-5.484 7.482-5.03 10.717.935 23.683 1.617 35.537 2.452 25.782 1.517 38.193 3.968h6.064l.86-2.451-2.073-1.517-1.618-1.517-36.776-24.922-39.81-26.338-20.852-15.166-11.273-7.683-5.687-7.204-2.451-15.721 10.237-11.273 13.75.935 3.513.936 13.928 10.716 29.749 23.027 38.848 28.612 5.687 4.727 2.275-1.617.278-1.138-2.553-4.271-21.13-38.193-22.546-38.848-10.035-16.101-2.654-9.655c-.935-3.968-1.617-7.304-1.617-11.374l11.652-15.823 6.445-2.073 15.545 2.073 6.547 5.687 9.655 22.092 15.646 34.78 24.265 47.291 7.103 14.028 3.791 12.992 1.416 3.968 2.449-.001v-2.275l1.997-26.641 3.69-32.707 3.589-42.084 1.239-11.854 5.863-14.206 11.652-7.683 9.099 4.348 7.482 10.716-1.036 6.926-4.449 28.915-8.72 45.294-5.687 30.331h3.313l3.792-3.791 15.342-20.372 25.782-32.227 11.374-12.789 13.27-14.129 8.517-6.724 16.1-.001 11.854 17.617-5.307 18.199-16.581 21.029-13.75 17.819-19.716 26.54-12.309 21.231 1.138 1.694 2.932-.278 44.536-9.479 24.062-4.347 28.714-4.928 12.992 6.066 1.416 6.167-5.106 12.613-30.71 7.583-36.018 7.204-53.636 12.689-.657.48.758.935 24.164 2.275 10.337.556h25.301l47.114 3.514 12.309 8.139 7.381 9.959-1.238 7.583-18.957 9.655-25.579-6.066-59.702-14.205-20.474-5.106-2.83-.001v1.694l17.061 16.682 31.266 28.233 39.152 36.397 1.997 8.999-5.03 7.102-5.307-.758-34.401-25.883-13.27-11.651-30.053-25.302-1.996-.001v2.654l6.926 10.136 36.574 54.975 1.895 16.859-2.653 5.485-9.479 3.311-10.414-1.895-21.408-30.054-22.092-33.844-17.819-30.331-2.173 1.238-10.515 113.261-4.929 5.788-11.374 4.348-9.478-7.204-5.03-11.652 5.03-23.027 6.066-30.052 4.928-23.886 4.449-29.674 2.654-9.858-.177-.657-2.173.278-22.37 30.71-34.021 45.977-26.919 28.815-6.445 2.553-11.173-5.789 1.037-10.337 6.243-9.2 37.257-47.392 22.47-29.371 14.508-16.961-.101-2.451h-.859l-98.954 64.251-17.618 2.275-7.583-7.103.936-11.652 3.589-3.791 29.749-20.474-.101.102.024.101z" />
                        </svg>
                    </button>
                    <button onclick="openAI('observer', 'grok')" class="ai-btn" title="Ask Grok">
                        <svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision"
                            text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd"
                            clip-rule="evenodd" viewBox="0 0 512 509.641">
                            <path
                                d="M115.612 0h280.776C459.975 0 512 52.026 512 115.612v278.416c0 63.587-52.025 115.613-115.612 115.613H115.612C52.026 509.641 0 457.615 0 394.028V115.612C0 52.026 52.026 0 115.612 0z" />
                            <path fill="#fff"
                                d="M213.235 306.019l178.976-180.002v.169l51.695-51.763c-.924 1.32-1.86 2.605-2.785 3.90-39.281 54.164-58.46 80.649-43.07 146.922l-.09-.101c10.61 45.11-.744 95.137-37.398 131.836-46.216 46.306-120.167 56.611-181.063 14.928l42.462-19.675c38.863 15.278 81.392 8.57 111.947-22.03 30.566-30.6 37.432-75.159 22.065-112.252-2.92-7.025-11.67-8.795-17.792-4.263l-124.947 92.341zm-25.786 22.437l-.033.034L68.094 435.217c7.565-10.429 16.957-20.294 26.327-30.149 26.428-27.803 52.653-55.359 36.654-94.302-21.422-52.112-8.952-113.177 30.724-152.898 41.243-41.254 101.98-51.661 152.706-30.758 11.23 4.172 21.016 10.114 28.638 15.639l-42.359 19.584c-39.44-16.563-84.629-5.299-112.207 22.313-37.298 37.308-44.84 102.003-1.128 143.81z" />
                        </svg>
                    </button>
                </div>
                <div class="sim-controls">
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                        <label style="font-weight: 500;">Observe Which Slit?</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggle-observe">
                            <span class="toggle-slider"></span>
                        </label>
                        <span id="observe-status" style="color: var(--accent); font-weight: 500;">OFF</span>
                    </div>
                    <div style="margin-top:0.5rem; text-align:right;">
                        <button id="btn-clear-observer"
                            style="padding:8px 16px; background:var(--text-main); color:var(--bg-color); border:none; border-radius:4px; cursor:pointer;">Clear
                            Pattern</button>
                    </div>
                </div>
            </div>
            <div class="visual-col">
                <canvas id="canvas-observer"></canvas>
            </div>
        </div>
    </section>

    <section class="references">
        <div style="max-width: 800px; margin: 0 auto;">
            <h3>Academic References</h3>
            <ul>
                <li><strong>Feynman, R. P.</strong> <em>The Feynman Lectures on Physics</em>, Vol. III, Chapter 1.</li>
                <li><strong>Griffiths, D. J.</strong> (2016). <em>Introduction to Quantum Mechanics</em>.</li>
            </ul>
        </div>
    </section>

    <script src="../js/common.js"></script>
    <script>
        function openAI(topic, model) {
            let prompt = "";
            switch (topic) {
                case 'classical':
                    prompt = "Explain how wave interference works in the double slit experiment when using classical waves like light or water.";
                    break;
                case 'quantum':
                    prompt = "Explain how individual photons or electrons create an interference pattern in the double slit experiment and what this tells us about quantum superposition.";
                    break;
                case 'observer':
                    prompt = "What is the observer effect in the double slit experiment? How does measurement change the outcome?";
                    break;
            }
            const encoded = encodeURIComponent(prompt);

            if (model === 'gemini') {
                navigator.clipboard.writeText(prompt).then(() => {
                    alert("Gemini doesn't support auto-fill. The prompt has been copied to your clipboard.");
                    window.open('https://gemini.google.com/app', '_blank');
                });
                return;
            }

            let url = "";
            switch (model) {
                case 'perplexity': url = `https://www.perplexity.ai/search?q=${encoded}`; break;
                case 'chatgpt': url = `https://chatgpt.com/?q=${encoded}`; break;
                case 'claude': url = `https://claude.ai/new?q=${encoded}`; break;
                case 'grok': url = `https://grok.com/?q=${encoded}`; break;
            }
            if (url) window.open(url, '_blank');
        }

        const APP = {
            visuals: [],
            observer: null,

            init() {
                this.setupObserver();
                this.initScrollAnimations();
                this.initVisuals();

                window.addEventListener('theme-changed', (e) => {
                    this.visuals.forEach(v => v.updateColors());
                });
            },

            setupObserver() {
                this.observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        const visual = this.visuals.find(v => v.canvas === entry.target);
                        if (visual) visual.isVisible = entry.isIntersecting;
                    });
                }, { threshold: 0.1 });
            },

            initScrollAnimations() {
                gsap.registerPlugin(ScrollTrigger);
                gsap.utils.toArray('h1, h2, h3').forEach(el => {
                    gsap.from(el, { opacity: 0, y: 30, duration: 1.2, ease: "power3.out", scrollTrigger: { trigger: el, start: "top 85%" } });
                });
                gsap.utils.toArray('.math-block').forEach(el => {
                    gsap.from(el, { scale: 0.95, opacity: 0, duration: 1, ease: "power2.out", scrollTrigger: { trigger: el, start: "top 90%" } });
                });
            },

            initVisuals() {
                this.addVisual(new ClassicalVisual('canvas-classical'));
                this.addVisual(new QuantumVisual('canvas-quantum'));
                this.addVisual(new ObserverVisual('canvas-observer'));
            },

            addVisual(visual) {
                this.visuals.push(visual);
                this.observer.observe(visual.canvas);
            }
        };

        class BaseVisual {
            constructor(id) {
                this.canvas = document.getElementById(id);
                this.ctx = this.canvas.getContext('2d');
                this.isVisible = false;
                this.updateColors();
                this.resize();
                window.addEventListener('resize', () => this.resize());
                this.loop();
            }
            updateColors() {
                this.color = getComputedStyle(document.body).getPropertyValue('--text-main').trim();
                this.bg = getComputedStyle(document.body).getPropertyValue('--bg-color').trim();
                this.accent = getComputedStyle(document.body).getPropertyValue('--accent').trim();
                this.secondary = getComputedStyle(document.body).getPropertyValue('--accent-secondary').trim();
            }
            resize() {
                const rect = this.canvas.parentElement.getBoundingClientRect();
                this.canvas.width = rect.width * 2;
                this.canvas.height = rect.height * 2;
                this.scale = 2;
                this.cx = this.canvas.width / 2;
                this.cy = this.canvas.height / 2;
            }
            loop() {
                if (this.isVisible) this.draw();
                requestAnimationFrame(() => this.loop());
            }
            draw() { }
        }

        class ClassicalVisual extends BaseVisual {
            constructor(id) {
                super(id);
                this.time = 0;
                this.wavelength = 1.0;
                this.slitSeparation = 1.0;

                // Setup controls
                const wavelengthInput = document.getElementById('input-wavelength');
                const slitSepInput = document.getElementById('input-slit-sep');

                wavelengthInput.addEventListener('input', (e) => {
                    this.wavelength = parseFloat(e.target.value);
                    document.getElementById('val-wavelength').textContent = e.target.value;
                });

                slitSepInput.addEventListener('input', (e) => {
                    this.slitSeparation = parseFloat(e.target.value);
                    document.getElementById('val-slit-sep').textContent = e.target.value;
                });
            }

            draw() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.time += 0.03;

                const slitY = this.cy;
                const slitSeparation = 80 * this.scale * this.slitSeparation;
                const slit1Y = slitY - slitSeparation / 2;
                const slit2Y = slitY + slitSeparation / 2;

                // Draw slits
                this.ctx.strokeStyle = this.color;
                this.ctx.lineWidth = 3 * this.scale;
                this.ctx.beginPath();
                this.ctx.moveTo(this.cx - 150 * this.scale, 0);
                this.ctx.lineTo(this.cx - 150 * this.scale, slit1Y - 20 * this.scale);
                this.ctx.moveTo(this.cx - 150 * this.scale, slit1Y + 20 * this.scale);
                this.ctx.lineTo(this.cx - 150 * this.scale, slit2Y - 20 * this.scale);
                this.ctx.moveTo(this.cx - 150 * this.scale, slit2Y + 20 * this.scale);
                this.ctx.lineTo(this.cx - 150 * this.scale, this.canvas.height);
                this.ctx.stroke();

                // Draw interference pattern
                for (let y = 0; y < this.canvas.height; y += 4 * this.scale) {
                    const dy = y - slitY;
                    const distance1 = Math.sqrt((dy + slitSeparation / 2) ** 2 + (200 * this.scale) ** 2);
                    const distance2 = Math.sqrt((dy - slitSeparation / 2) ** 2 + (200 * this.scale) ** 2);
                    const phaseDiff = (distance1 - distance2) * (0.05 / this.wavelength) + this.time;
                    const intensity = Math.cos(phaseDiff) ** 2;

                    this.ctx.fillStyle = this.accent;
                    this.ctx.globalAlpha = intensity * 0.8;
                    this.ctx.fillRect(this.cx + 100 * this.scale, y, 6 * this.scale, 4 * this.scale);
                }
                this.ctx.globalAlpha = 1;
            }
        }

        class QuantumVisual extends BaseVisual {
            constructor(id) {
                super(id);
                this.particles = [];
                this.detections = [];
                this.maxDetections = 400;
                this.particleTimer = 0;
                this.emissionRate = 10;

                // Setup controls
                const emissionInput = document.getElementById('input-emission');
                const clearBtn = document.getElementById('btn-clear-quantum');

                emissionInput.addEventListener('input', (e) => {
                    this.emissionRate = parseInt(e.target.value);
                    document.getElementById('val-emission').textContent = e.target.value;
                });

                clearBtn.addEventListener('click', () => {
                    this.detections = [];
                    this.particles = [];
                });
            }

            draw() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

                const slitY = this.cy;
                const slitSeparation = 80 * this.scale;

                // Draw slits
                this.ctx.strokeStyle = this.color;
                this.ctx.lineWidth = 3 * this.scale;
                this.ctx.beginPath();
                const slitX = this.cx - 150 * this.scale;
                this.ctx.moveTo(slitX, 0);
                this.ctx.lineTo(slitX, slitY - slitSeparation / 2 - 20 * this.scale);
                this.ctx.moveTo(slitX, slitY - slitSeparation / 2 + 20 * this.scale);
                this.ctx.lineTo(slitX, slitY + slitSeparation / 2 - 20 * this.scale);
                this.ctx.moveTo(slitX, slitY + slitSeparation / 2 + 20 * this.scale);
                this.ctx.lineTo(slitX, this.canvas.height);
                this.ctx.stroke();

                // Emit particles based on emission rate
                this.particleTimer++;
                if (this.particleTimer > this.emissionRate) {
                    this.particles.push({ x: 50 * this.scale, y: slitY, vx: 4 * this.scale, vy: 0 });
                    this.particleTimer = 0;
                }

                // Update particles
                this.particles = this.particles.filter(p => {
                    p.x += p.vx;
                    if (p.x > this.cx + 100 * this.scale) {
                        const dy = p.y - slitY;
                        const distance1 = Math.sqrt((dy + slitSeparation / 2) ** 2 + (250 * this.scale) ** 2);
                        const distance2 = Math.sqrt((dy - slitSeparation / 2) ** 2 + (250 * this.scale) ** 2);
                        const phaseDiff = (distance1 - distance2) * 0.05;
                        const probability = Math.cos(phaseDiff) ** 2;
                        if (Math.random() < probability) {
                            this.detections.push({ x: this.cx + 100 * this.scale, y: p.y });
                            if (this.detections.length > this.maxDetections) this.detections.shift();
                        }
                        return false;
                    }

                    this.ctx.fillStyle = this.accent;
                    this.ctx.beginPath();
                    this.ctx.arc(p.x, p.y, 3 * this.scale, 0, Math.PI * 2);
                    this.ctx.fill();
                    return true;
                });

                // Draw detection pattern
                this.ctx.fillStyle = this.secondary;
                this.detections.forEach(d => {
                    this.ctx.beginPath();
                    this.ctx.arc(d.x, d.y, 2 * this.scale, 0, Math.PI * 2);
                    this.ctx.fill();
                });
            }
        }

        class ObserverVisual extends BaseVisual {
            constructor(id) {
                super(id);
                this.particles = [];
                this.detections = [];
                this.maxDetections = 400;
                this.particleTimer = 0;
                this.observing = false;

                // Setup controls
                const observeToggle = document.getElementById('toggle-observe');
                const observeStatus = document.getElementById('observe-status');
                const clearBtn = document.getElementById('btn-clear-observer');

                observeToggle.addEventListener('change', (e) => {
                    this.observing = e.target.checked;
                    observeStatus.textContent = this.observing ? 'ON' : 'OFF';
                    observeStatus.style.color = this.observing ? 'var(--accent-secondary)' : 'var(--accent)';
                    this.detections = [];
                    this.particles = [];
                });

                clearBtn.addEventListener('click', () => {
                    this.detections = [];
                    this.particles = [];
                });
            }

            draw() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

                const slitY = this.cy;
                const slitSeparation = 80 * this.scale;

                // Draw slits
                this.ctx.strokeStyle = this.color;
                this.ctx.lineWidth = 3 * this.scale;
                this.ctx.beginPath();
                const slitX = this.cx - 150 * this.scale;
                this.ctx.moveTo(slitX, 0);
                this.ctx.lineTo(slitX, slitY - slitSeparation / 2 - 20 * this.scale);
                this.ctx.moveTo(slitX, slitY - slitSeparation / 2 + 20 * this.scale);
                this.ctx.lineTo(slitX, slitY + slitSeparation / 2 - 20 * this.scale);
                this.ctx.moveTo(slitX, slitY + slitSeparation / 2 + 20 * this.scale);
                this.ctx.lineTo(slitX, this.canvas.height);
                this.ctx.stroke();

                // Emit particles
                this.particleTimer++;
                if (this.particleTimer > 10) {
                    if (this.observing) {
                        // When observing: particle goes through specific slit (particle behavior)
                        const chosenSlit = Math.random() > 0.5 ? -1 : 1;
                        this.particles.push({
                            x: 50 * this.scale,
                            y: slitY + chosenSlit * slitSeparation / 2,
                            vx: 4 * this.scale,
                            vy: 0,
                            slit: chosenSlit
                        });
                    } else {
                        // When not observing: superposition (wave behavior)
                        this.particles.push({
                            x: 50 * this.scale,
                            y: slitY,
                            vx: 4 * this.scale,
                            vy: 0,
                            slit: null
                        });
                    }
                    this.particleTimer = 0;
                }

                // Update particles
                this.particles = this.particles.filter(p => {
                    p.x += p.vx;
                    if (p.x > this.cx + 100 * this.scale) {
                        if (this.observing) {
                            // Classical pattern: no interference
                            this.detections.push({ x: this.cx + 100 * this.scale, y: p.y });
                        } else {
                            // Quantum pattern: interference
                            const dy = p.y - slitY;
                            const distance1 = Math.sqrt((dy + slitSeparation / 2) ** 2 + (250 * this.scale) ** 2);
                            const distance2 = Math.sqrt((dy - slitSeparation / 2) ** 2 + (250 * this.scale) ** 2);
                            const phaseDiff = (distance1 - distance2) * 0.05;
                            const probability = Math.cos(phaseDiff) ** 2;
                            if (Math.random() < probability) {
                                this.detections.push({ x: this.cx + 100 * this.scale, y: p.y });
                            }
                        }
                        if (this.detections.length > this.maxDetections) this.detections.shift();
                        return false;
                    }

                    this.ctx.fillStyle = this.accent;
                    this.ctx.beginPath();
                    this.ctx.arc(p.x, p.y, 3 * this.scale, 0, Math.PI * 2);
                    this.ctx.fill();
                    return true;
                });

                // Draw detection pattern
                this.ctx.fillStyle = this.color;
                this.detections.forEach(d => {
                    this.ctx.beginPath();
                    this.ctx.arc(d.x, d.y, 2 * this.scale, 0, Math.PI * 2);
                    this.ctx.fill();
                });
            }
        }

        window.onload = () => APP.init();
    </script>
</body>

</html>