<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gravitational Waves • Physics Notebook</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/article.css">
    <style>
        /* AI Links */
        .ai-links {
            display: flex;
            gap: 0.8rem;
            margin-top: 1rem;
            align-items: center;
        }

        .ai-label {
            font-size: 0.8rem;
            opacity: 0.6;
            margin-right: 0.2rem;
            font-weight: 500;
        }

        .ai-btn {
            background: var(--bg-color);
            border: 1px solid var(--line-subtle);
            color: var(--text-muted);
            min-width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 0 8px;
        }

        .ai-btn svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        /* Slider Controls */
        .controls {
            margin-top: 1.5rem;
            padding: 1rem;
            background: var(--bg-color);
            border: 1px solid var(--line-subtle);
            border-radius: 8px;
        }

        .control-group {
            margin-bottom: 1rem;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        .control-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .control-value {
            background: var(--accent);
            color: var(--bg-color);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-family: 'JetBrains Mono', monospace;
        }

        .slider {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: var(--line-subtle);
            border-radius: 3px;
            outline: none;
            cursor: pointer;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            border: none;
            transition: transform 0.2s ease;
        }

        .slider::-moz-range-thumb:hover {
            transform: scale(1.2);
        }
    </style>

    <!-- MathJax Configuration -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Theme Init -->
    <script>
        const savedTheme = localStorage.getItem('physics-notebook-theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        document.body && document.body.setAttribute('data-theme', savedTheme);
    </script>

    <!-- Libs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>

    <nav class="sticky">
        <div class="nav-bg"></div>
        <a href="../index.html" class="logo">
            <i data-lucide="arrow-left" width="16"></i>
            Library
        </a>
        <button id="themeBtn">
            <i data-lucide="moon" width="16"></i> Mode
        </button>
    </nav>

    <!-- HERO -->
    <section class="hero">
        <div class="text-reveal-wrapper">
            <h1 class="hero-title">Gravitational<br>Waves</h1>
            <p style="margin-top: 2rem; font-size: 1.4rem; max-width: 40ch;">
                Ripples in spacetime that propagate at the speed of light, carrying information about cosmic events across the universe.
            </p>
        </div>
    </section>

    <!-- CHAPTER 1: SPACETIME RIPPLES -->
    <section>
        <div class="split-layout">
            <div class="content-col">
                <h3 class="section-label" style="color: var(--accent);">01. The Ripples</h3>
                <h2>Spacetime Distortions</h2>
                <p>
                    Gravitational waves are ripples in the fabric of spacetime itself, predicted by Einstein's General Relativity. When massive objects accelerate, they create disturbances that propagate outward at the speed of light, stretching and compressing space as they travel.
                </p>
                <div class="math-block">
                    $$h_{\mu\nu} \propto \frac{1}{r} \frac{d^2Q}{dt^2}$$
                </div>
                <p>
                    The amplitude of gravitational waves decreases with distance (1/r), while the strain is proportional to the second time derivative of the quadrupole moment of the source. This means only the most violent cosmic events produce detectable signals.
                </p>

                <!-- SLIDER CONTROLS -->
                <div class="controls">
                    <div class="control-group">
                        <div class="control-label">
                            <span>Wave Frequency</span>
                            <span class="control-value" id="ripple-freq-value">1.0 Hz</span>
                        </div>
                        <input type="range" class="slider" id="ripple-freq" min="0.2" max="3.0" step="0.1" value="1.0">
                    </div>
                    <div class="control-group">
                        <div class="control-label">
                            <span>Wave Amplitude</span>
                            <span class="control-value" id="ripple-amp-value">1.0</span>
                        </div>
                        <input type="range" class="slider" id="ripple-amp" min="0.2" max="2.0" step="0.1" value="1.0">
                    </div>
                </div>

                <!-- ETU CARD -->
                <div class="etu-card">
                    <span class="etu-tag">Real World Analogy</span>
                    <h4 style="margin-bottom:0.5rem;">Pond Ripples</h4>
                    <p style="font-size: 0.95rem; margin-bottom:0;">
                        Imagine dropping a stone in a calm pond. The ripples spread outward, causing the water surface to rise and fall. Gravitational waves work similarly—but instead of water, they ripple through spacetime itself, stretching and compressing the universe as they pass.
                    </p>
                </div>

                <!-- AI LINKS -->
                <div class="ai-links">
                    <span class="ai-label">Ask AI:</span>
                    <button onclick="openAI('spacetime', 'perplexity')" class="ai-btn" title="Ask Perplexity"><svg
                            viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M22.3977 7.0896h-2.3106V.0676l-7.5094 6.3542V.1577h-1.1554v6.1966L4.4904 0v7.0896H1.6023v10.3976h2.8882V24l6.932-6.3591v6.2005h1.1554v-6.0469l6.9318 6.1807v-6.4879h2.8882V7.0896zm-3.4657-4.531v4.531h-5.355l5.355-4.531zm-13.2862.0676 4.8691 4.4634H5.6458V2.6262zM2.7576 16.332V8.245h7.8476l-6.1149 6.1147v1.9723H2.7576zm2.8882 5.0404v-3.8852h.0001v-2.6488l5.7763-5.7764v7.0111l-5.7764 5.2993zm12.7086.0248-5.7766-5.1509V9.0618l5.7766 5.7766v6.5588zm2.8882-5.0652h-1.733v-1.9723L13.3948 8.245h7.8478v8.087z" />
                        </svg></button>
                    <button onclick="openAI('spacetime', 'gemini')" class="ai-btn" title="Ask Gemini"><svg
                            viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M11.04 19.32Q12 21.51 12 24q0-2.49.93-4.68.96-2.19 2.58-3.81t3.81-2.55Q21.51 12 24 12q-2.49 0-4.68-.93a12.3 12.3 0 0 1-3.81-2.58 12.3 12.3 0 0 1-2.58-3.81Q12 2.49 12 0q0 2.49-.96 4.68-.93 2.19-2.55 3.81a12.3 12.3 0 0 1-3.81 2.58Q2.49 12 0 12q2.49 0 4.68.96 2.19.93 3.81 2.55t2.55 3.81" />
                        </svg></button>
                    <button onclick="openAI('spacetime', 'chatgpt')" class="ai-btn" title="Ask ChatGPT"><svg
                            viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M22.2819 9.8211a5.9847 5.9847 0 0 0-.5157-4.9108 6.0462 6.0462 0 0 0-6.5098-2.9A6.0651 6.0651 0 0 0 4.9807 4.1818a5.9847 5.9847 0 0 0-3.9977 2.9 6.0462 6.0462 0 0 0 .7427 7.0966 5.98 5.98 0 0 0 .511 4.9107 6.051 6.051 0 0 0 6.5146 2.9001A5.9847 5.9847 0 0 0 13.2599 24a6.0557 6.0557 0 0 0 5.7718-4.2058 5.9894 5.9894 0 0 0 3.9977-2.9001 6.0557 6.0557 0 0 0-.7475-7.0729zm-9.022 12.6081a4.4755 4.4755 0 0 1-2.8764-1.0408l.1419-.0804 4.7783-2.7582a.7948.7948 0 0 0 .3927-.6813v-6.7369l2.02 1.1686a.071.071 0 0 1 .038.052v5.5826a4.504 4.504 0 0 1-4.4945 4.4944zm-9.6607-4.1254a4.4708 4.4708 0 0 1-.5346-3.0137l.142.0852 4.783 2.7582a.7712.7712 0 0 0 .7806 0l5.8428-3.3685v2.3324a.0804.0804 0 0 1-.0332.0615L9.74 19.9502a4.4992 4.9992 0 0 1-6.1408-1.6464zM2.3408 7.8956a4.485 4.4847 0 0 1 2.3655-1.9728V11.6a.7664.7664 0 0 0 .3879.6765l5.8144 3.3543-2.0201 1.1685a.0757.0757 0 0 1-.071 0l-4.8303-2.7865A4.504 4.504 0 0 1 2.3408 7.872zm16.5963 3.8558L13.1038 8.364 15.1192 7.2a.0757.0757 0 0 1 .071 0l4.8303 2.7913a4.4944 4.4944 0 0 1-.6765 8.1042v-5.6772a.79.79 0 0 0-.407-.667zm2.0107-3.0231l-.142-.0852-4.7735-2.7818a.7759.7759 0 0 0-.7854 0L9.409 9.2297V6.8974a.0662.0662 0 0 1 .0284-.0615l4.8303-2.7866a4.4992 4.4992 0 0 1 6.6802 4.66zM8.3065 12.863l-2.02-1.1638a.0804.0804 0 0 1-.038-.0567V6.0742a4.4992 4.4992 0 0 1 7.3757-3.4537l-.142.0805L8.704 5.459a.7948.7948 0 0 0-.3927.6813zm1.0976-2.3654l2.602-1.4998 2.6069 1.4998v2.9994l-2.5974 1.4997-2.6067-1.4997Z" />
                        </svg></button>
                    <button onclick="openAI('spacetime', 'claude')" class="ai-btn" title="Ask Claude"><svg
                            xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision"
                            text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd"
                            clip-rule="evenodd" viewBox="0 0 512 509.64">
                            <path fill="#D77655"
                                d="M115.612 0h280.775C459.974 0 512 52.026 512 115.612v278.415c0 63.587-52.026 115.612-115.613 115.612H115.612C52.026 509.639 0 457.614 0 394.027V115.612C0 52.026 52.026 0 115.612 0z" />
                            <path fill="#FCF2EE" fill-rule="nonzero"
                                d="M142.27 316.619l73.655-41.326 1.238-3.589-1.238-1.996-3.589-.001-12.31-.759-42.084-1.138-36.498-1.516-35.361-1.896-8.897-1.895-8.34-10.995.859-5.484 7.482-5.03 10.717.935 23.683 1.617 35.537 2.452 25.782 1.517 38.193 3.968h6.064l.86-2.451-2.073-1.517-1.618-1.517-36.776-24.922-39.81-26.338-20.852-15.166-11.273-7.683-5.687-7.204-2.451-15.721 10.237-11.273 13.75.935 3.513.936 13.928 10.716 29.749 23.027 38.848 28.612 5.687 4.727 2.275-1.617.278-1.138-2.553-4.271-21.13-38.193-22.546-38.848-10.035-16.101-2.654-9.655c-.935-3.968-1.617-7.304-1.617-11.374l11.652-15.823 6.445-2.073 15.545 2.073 6.547 5.687 9.655 22.092 15.646 34.78 24.265 47.291 7.103 14.028 3.791 12.992 1.416 3.968 2.449-.001v-2.275l1.997-26.641 3.69-32.707 3.589-42.084 1.239-11.854 5.863-14.206 11.652-7.683 9.099 4.348 7.482 10.716-1.036 6.926-4.449 28.915-8.72 45.294-5.687 30.331h3.313l3.792-3.791 15.342-20.372 25.782-32.227 11.374-12.789 13.27-14.129 8.517-6.724 16.1-.001 11.854 17.617-5.307 18.199-16.581 21.029-13.75 17.819-19.716 26.54-12.309 21.231 1.138 1.694 2.932-.278 44.536-9.479 24.062-4.347 28.714-4.928 12.992 6.066 1.416 6.167-5.106 12.613-30.71 7.583-36.018 7.204-53.636 12.689-.657.48.758.935 24.164 2.275 10.337.556h25.301l47.114 3.514 12.309 8.139 7.381 9.959-1.238 7.583-18.957 9.655-25.579-6.066-59.702-14.205-20.474-5.106-2.83-.001v1.694l17.061 16.682 31.266 28.233 39.152 36.397 1.997 8.999-5.03 7.102-5.307-.758-34.401-25.883-13.27-11.651-30.053-25.302-1.996-.001v2.654l6.926 10.136 36.574 54.975 1.895 16.859-2.653 5.485-9.479 3.311-10.414-1.895-21.408-30.054-22.092-33.844-17.819-30.331-2.173 1.238-10.515 113.261-4.929 5.788-11.374 4.348-9.478-7.204-5.03-11.652 5.03-23.027 6.066-30.052 4.928-23.886 4.449-29.674 2.654-9.858-.177-.657-2.173.278-22.37 30.71-34.021 45.977-26.919 28.815-6.445 2.553-11.173-5.789 1.037-10.337 6.243-9.2 37.257-47.392 22.47-29.371 14.508-16.961-.101-2.451h-.859l-98.954 64.251-17.618 2.275-7.583-7.103.936-11.652 3.589-3.791 29.749-20.474-.101.102.024.101z" />
                        </svg></button>
                    <button onclick="openAI('spacetime', 'grok')" class="ai-btn" title="Ask Grok"><svg
                            xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision"
                            text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd"
                            clip-rule="evenodd" viewBox="0 0 512 509.641">
                            <path
                                d="M115.612 0h280.776C459.975 0 512 52.026 512 115.612v278.416c0 63.587-52.025 115.613-115.612 115.613H115.612C52.026 509.641 0 457.615 0 394.028V115.612C0 52.026 52.026 0 115.612 0z" />
                            <path fill="#fff"
                                d="M213.235 306.019l178.976-180.002v.169l51.695-51.763c-.924 1.32-1.86 2.605-2.785 3.89-39.281 54.164-58.46 80.649-43.07 146.922l-.09-.101c10.61 45.11-.744 95.137-37.398 131.836-46.216 46.306-120.167 56.611-181.063 14.928l42.462-19.675c38.863 15.278 81.392 8.57 111.947-22.03 30.566-30.6 37.432-75.159 22.065-112.252-2.92-7.025-11.67-8.795-17.792-4.263l-124.947 92.341zm-25.786 22.437l-.033.034L68.094 435.217c7.565-10.429 16.957-20.294 26.327-30.149 26.428-27.803 52.653-55.359 36.654-94.302-21.422-52.112-8.952-113.177 30.724-152.898 41.243-41.254 101.98-51.661 152.706-30.758 11.23 4.172 21.016 10.114 28.638 15.639l-42.359 19.584c-39.44-16.563-84.629-5.299-112.207 22.313-37.298 37.308-44.84 102.003-1.128 143.81z" />
                        </svg></button>
                </div>
            </div>
            <div class="visual-col">
                <canvas id="canvas-spacetime"></canvas>
            </div>
        </div>
    </section>

    <div class="divider"></div>

    <!-- CHAPTER 2: BINARY MERGERS -->
    <section>
        <div class="split-layout">
            <div class="content-col">
                <h3 class="section-label" style="color: var(--accent-secondary);">02. The Source</h3>
                <h2>Binary Black Hole Mergers</h2>
                <p>
                    The most powerful gravitational wave sources are binary systems of black holes or neutron stars spiraling toward each other. As they orbit, they lose energy through gravitational radiation, causing their orbits to decay and eventually merge in a catastrophic event.
                </p>
                <div class="math-block">
                    $$P = \frac{32}{5}\frac{G^4}{c^5}\frac{m_1^2 m_2^2 (m_1 + m_2)}{a^5}$$
                </div>
                <p>
                    This equation describes the power radiated in gravitational waves by a binary system. The closer the objects get (smaller separation a), the more intensely they radiate, leading to an inspiral that accelerates until merger. LIGO has detected dozens of such events, confirming Einstein's predictions.
                </p>

                <!-- SLIDER CONTROLS -->
                <div class="controls">
                    <div class="control-group">
                        <div class="control-label">
                            <span>Black Hole Mass</span>
                            <span class="control-value" id="merger-mass-value">30 M☉</span>
                        </div>
                        <input type="range" class="slider" id="merger-mass" min="10" max="50" step="1" value="30">
                    </div>
                    <div class="control-group">
                        <div class="control-label">
                            <span>Initial Separation</span>
                            <span class="control-value" id="merger-sep-value">120 km</span>
                        </div>
                        <input type="range" class="slider" id="merger-sep" min="60" max="180" step="5" value="120">
                    </div>
                </div>

                <!-- ETU CARD -->
                <div class="etu-card">
                    <span class="etu-tag">Real World Analogy</span>
                    <h4 style="margin-bottom:0.5rem;">Spinning Ice Skaters</h4>
                    <p style="font-size: 0.95rem; margin-bottom:0;">
                        Like ice skaters pulling in their arms to spin faster, binary black holes spiral inward as they lose energy. The gravitational waves they emit are like the energy the skaters lose to friction—each wave carries away a bit of orbital energy, causing the black holes to spiral closer together.
                    </p>
                </div>

                <!-- AI LINKS -->
                <div class="ai-links">
                    <span class="ai-label">Ask AI:</span>
                    <button onclick="openAI('mergers', 'perplexity')" class="ai-btn" title="Ask Perplexity"><svg
                            viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M22.3977 7.0896h-2.3106V.0676l-7.5094 6.3542V.1577h-1.1554v6.1966L4.4904 0v7.0896H1.6023v10.3976h2.8882V24l6.932-6.3591v6.2005h1.1554v-6.0469l6.9318 6.1807v-6.4879h2.8882V7.0896zm-3.4657-4.531v4.531h-5.355l5.355-4.531zm-13.2862.0676 4.8691 4.4634H5.6458V2.6262zM2.7576 16.332V8.245h7.8476l-6.1149 6.1147v1.9723H2.7576zm2.8882 5.0404v-3.8852h.0001v-2.6488l5.7763-5.7764v7.0111l-5.7764 5.2993zm12.7086.0248-5.7766-5.1509V9.0618l5.7766 5.7766v6.5588zm2.8882-5.0652h-1.733v-1.9723L13.3948 8.245h7.8478v8.087z" />
                        </svg></button>
                    <button onclick="openAI('mergers', 'gemini')" class="ai-btn" title="Ask Gemini"><svg
                            viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M11.04 19.32Q12 21.51 12 24q0-2.49.93-4.68.96-2.19 2.58-3.81t3.81-2.55Q21.51 12 24 12q-2.49 0-4.68-.93a12.3 12.3 0 0 1-3.81-2.58 12.3 12.3 0 0 1-2.58-3.81Q12 2.49 12 0q0 2.49-.96 4.68-.93 2.19-2.55 3.81a12.3 12.3 0 0 1-3.81 2.58Q2.49 12 0 12q2.49 0 4.68.96 2.19.93 3.81 2.55t2.55 3.81" />
                        </svg></button>
                    <button onclick="openAI('mergers', 'chatgpt')" class="ai-btn" title="Ask ChatGPT"><svg
                            viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M22.2819 9.8211a5.9847 5.9847 0 0 0-.5157-4.9108 6.0462 6.0462 0 0 0-6.5098-2.9A6.0651 6.0651 0 0 0 4.9807 4.1818a5.9847 5.9847 0 0 0-3.9977 2.9 6.0462 6.0462 0 0 0 .7427 7.0966 5.98 5.98 0 0 0 .511 4.9107 6.051 6.051 0 0 0 6.5146 2.9001A5.9847 5.9847 0 0 0 13.2599 24a6.0557 6.0557 0 0 0 5.7718-4.2058 5.9894 5.9894 0 0 0 3.9977-2.9001 6.0557 6.0557 0 0 0-.7475-7.0729zm-9.022 12.6081a4.4755 4.4755 0 0 1-2.8764-1.0408l.1419-.0804 4.7783-2.7582a.7948.7948 0 0 0 .3927-.6813v-6.7369l2.02 1.1686a.071.071 0 0 1 .038.052v5.5826a4.504 4.504 0 0 1-4.4945 4.4944zm-9.6607-4.1254a4.4708 4.4708 0 0 1-.5346-3.0137l.142.0852 4.783 2.7582a.7712.7712 0 0 0 .7806 0l5.8428-3.3685v2.3324a.0804.0804 0 0 1-.0332.0615L9.74 19.9502a4.4992 4.9992 0 0 1-6.1408-1.6464zM2.3408 7.8956a4.485 4.4847 0 0 1 2.3655-1.9728V11.6a.7664.7664 0 0 0 .3879.6765l5.8144 3.3543-2.0201 1.1685a.0757.0757 0 0 1-.071 0l-4.8303-2.7865A4.504 4.504 0 0 1 2.3408 7.872zm16.5963 3.8558L13.1038 8.364 15.1192 7.2a.0757.0757 0 0 1 .071 0l4.8303 2.7913a4.4944 4.4944 0 0 1-.6765 8.1042v-5.6772a.79.79 0 0 0-.407-.667zm2.0107-3.0231l-.142-.0852-4.7735-2.7818a.7759.7759 0 0 0-.7854 0L9.409 9.2297V6.8974a.0662.0662 0 0 1 .0284-.0615l4.8303-2.7866a4.4992 4.4992 0 0 1 6.6802 4.66zM8.3065 12.863l-2.02-1.1638a.0804.0804 0 0 1-.038-.0567V6.0742a4.4992 4.4992 0 0 1 7.3757-3.4537l-.142.0805L8.704 5.459a.7948.7948 0 0 0-.3927.6813zm1.0976-2.3654l2.602-1.4998 2.6069 1.4998v2.9994l-2.5974 1.4997-2.6067-1.4997Z" />
                        </svg></button>
                    <button onclick="openAI('mergers', 'claude')" class="ai-btn" title="Ask Claude"><svg
                            xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision"
                            text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd"
                            clip-rule="evenodd" viewBox="0 0 512 509.64">
                            <path fill="#D77655"
                                d="M115.612 0h280.775C459.974 0 512 52.026 512 115.612v278.415c0 63.587-52.026 115.612-115.613 115.612H115.612C52.026 509.639 0 457.614 0 394.027V115.612C0 52.026 52.026 0 115.612 0z" />
                            <path fill="#FCF2EE" fill-rule="nonzero"
                                d="M142.27 316.619l73.655-41.326 1.238-3.589-1.238-1.996-3.589-.001-12.31-.759-42.084-1.138-36.498-1.516-35.361-1.896-8.897-1.895-8.34-10.995.859-5.484 7.482-5.03 10.717.935 23.683 1.617 35.537 2.452 25.782 1.517 38.193 3.968h6.064l.86-2.451-2.073-1.517-1.618-1.517-36.776-24.922-39.81-26.338-20.852-15.166-11.273-7.683-5.687-7.204-2.451-15.721 10.237-11.273 13.75.935 3.513.936 13.928 10.716 29.749 23.027 38.848 28.612 5.687 4.727 2.275-1.617.278-1.138-2.553-4.271-21.13-38.193-22.546-38.848-10.035-16.101-2.654-9.655c-.935-3.968-1.617-7.304-1.617-11.374l11.652-15.823 6.445-2.073 15.545 2.073 6.547 5.687 9.655 22.092 15.646 34.78 24.265 47.291 7.103 14.028 3.791 12.992 1.416 3.968 2.449-.001v-2.275l1.997-26.641 3.69-32.707 3.589-42.084 1.239-11.854 5.863-14.206 11.652-7.683 9.099 4.348 7.482 10.716-1.036 6.926-4.449 28.915-8.72 45.294-5.687 30.331h3.313l3.792-3.791 15.342-20.372 25.782-32.227 11.374-12.789 13.27-14.129 8.517-6.724 16.1-.001 11.854 17.617-5.307 18.199-16.581 21.029-13.75 17.819-19.716 26.54-12.309 21.231 1.138 1.694 2.932-.278 44.536-9.479 24.062-4.347 28.714-4.928 12.992 6.066 1.416 6.167-5.106 12.613-30.71 7.583-36.018 7.204-53.636 12.689-.657.48.758.935 24.164 2.275 10.337.556h25.301l47.114 3.514 12.309 8.139 7.381 9.959-1.238 7.583-18.957 9.655-25.579-6.066-59.702-14.205-20.474-5.106-2.83-.001v1.694l17.061 16.682 31.266 28.233 39.152 36.397 1.997 8.999-5.03 7.102-5.307-.758-34.401-25.883-13.27-11.651-30.053-25.302-1.996-.001v2.654l6.926 10.136 36.574 54.975 1.895 16.859-2.653 5.485-9.479 3.311-10.414-1.895-21.408-30.054-22.092-33.844-17.819-30.331-2.173 1.238-10.515 113.261-4.929 5.788-11.374 4.348-9.478-7.204-5.03-11.652 5.03-23.027 6.066-30.052 4.928-23.886 4.449-29.674 2.654-9.858-.177-.657-2.173.278-22.37 30.71-34.021 45.977-26.919 28.815-6.445 2.553-11.173-5.789 1.037-10.337 6.243-9.2 37.257-47.392 22.47-29.371 14.508-16.961-.101-2.451h-.859l-98.954 64.251-17.618 2.275-7.583-7.103.936-11.652 3.589-3.791 29.749-20.474-.101.102.024.101z" />
                        </svg></button>
                    <button onclick="openAI('mergers', 'grok')" class="ai-btn" title="Ask Grok"><svg
                            xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision"
                            text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd"
                            clip-rule="evenodd" viewBox="0 0 512 509.641">
                            <path
                                d="M115.612 0h280.776C459.975 0 512 52.026 512 115.612v278.416c0 63.587-52.025 115.613-115.612 115.613H115.612C52.026 509.641 0 457.615 0 394.028V115.612C0 52.026 52.026 0 115.612 0z" />
                            <path fill="#fff"
                                d="M213.235 306.019l178.976-180.002v.169l51.695-51.763c-.924 1.32-1.86 2.605-2.785 3.89-39.281 54.164-58.46 80.649-43.07 146.922l-.09-.101c10.61 45.11-.744 95.137-37.398 131.836-46.216 46.306-120.167 56.611-181.063 14.928l42.462-19.675c38.863 15.278 81.392 8.57 111.947-22.03 30.566-30.6 37.432-75.159 22.065-112.252-2.92-7.025-11.67-8.795-17.792-4.263l-124.947 92.341zm-25.786 22.437l-.033.034L68.094 435.217c7.565-10.429 16.957-20.294 26.327-30.149 26.428-27.803 52.653-55.359 36.654-94.302-21.422-52.112-8.952-113.177 30.724-152.898 41.243-41.254 101.98-51.661 152.706-30.758 11.23 4.172 21.016 10.114 28.638 15.639l-42.359 19.584c-39.44-16.563-84.629-5.299-112.207 22.313-37.298 37.308-44.84 102.003-1.128 143.81z" />
                        </svg></button>
                </div>
            </div>
            <div class="visual-col">
                <canvas id="canvas-mergers"></canvas>
            </div>
        </div>
    </section>

    <div class="divider"></div>

    <!-- CHAPTER 3: DETECTION -->
    <section>
        <div class="split-layout">
            <div class="content-col">
                <h3 class="section-label" style="color: var(--accent);">03. The Discovery</h3>
                <h2>LIGO and Interferometry</h2>
                <p>
                    The Laser Interferometer Gravitational-Wave Observatory (LIGO) made history in 2015 by detecting gravitational waves for the first time. Using 4-kilometer arms with laser beams, LIGO measures changes in length smaller than a proton's diameter as waves pass through.
                </p>
                <div class="math-block">
                    $$\Delta L = \frac{4L}{\lambda} \cdot h$$
                </div>
                <p>
                    This equation shows how a gravitational wave with strain h causes a path length difference ΔL in an interferometer with arm length L and laser wavelength λ. The longer the arms and the shorter the wavelength, the more sensitive the detector becomes.
                </p>

                <!-- SLIDER CONTROLS -->
                <div class="controls">
                    <div class="control-group">
                        <div class="control-label">
                            <span>Signal Frequency</span>
                            <span class="control-value" id="detection-freq-value">100 Hz</span>
                        </div>
                        <input type="range" class="slider" id="detection-freq" min="50" max="200" step="5" value="100">
                    </div>
                    <div class="control-group">
                        <div class="control-label">
                            <span>Signal Amplitude</span>
                            <span class="control-value" id="detection-amp-value">1.0</span>
                        </div>
                        <input type="range" class="slider" id="detection-amp" min="0.2" max="2.0" step="0.1" value="1.0">
                    </div>
                </div>

                <!-- ETU CARD -->
                <div class="etu-card">
                    <span class="etu-tag">Real World Analogy</span>
                    <h4 style="margin-bottom:0.5rem;">Measuring with Light</h4>
                    <p style="font-size: 0.95rem; margin-bottom:0;">
                        Imagine measuring the distance to the Moon with a laser. If the Moon moved by a single hair's width, you'd never notice. But LIGO does something even harder—it detects changes smaller than a proton by comparing laser beams traveling in perpendicular directions, looking for tiny timing differences.
                    </p>
                </div>

                <!-- AI LINKS -->
                <div class="ai-links">
                    <span class="ai-label">Ask AI:</span>
                    <button onclick="openAI('detection', 'perplexity')" class="ai-btn" title="Ask Perplexity"><svg
                            viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M22.3977 7.0896h-2.3106V.0676l-7.5094 6.3542V.1577h-1.1554v6.1966L4.4904 0v7.0896H1.6023v10.3976h2.8882V24l6.932-6.3591v6.2005h1.1554v-6.0469l6.9318 6.1807v-6.4879h2.8882V7.0896zm-3.4657-4.531v4.531h-5.355l5.355-4.531zm-13.2862.0676 4.8691 4.4634H5.6458V2.6262zM2.7576 16.332V8.245h7.8476l-6.1149 6.1147v1.9723H2.7576zm2.8882 5.0404v-3.8852h.0001v-2.6488l5.7763-5.7764v7.0111l-5.7764 5.2993zm12.7086.0248-5.7766-5.1509V9.0618l5.7766 5.7766v6.5588zm2.8882-5.0652h-1.733v-1.9723L13.3948 8.245h7.8478v8.087z" />
                        </svg></button>
                    <button onclick="openAI('detection', 'gemini')" class="ai-btn" title="Ask Gemini"><svg
                            viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M11.04 19.32Q12 21.51 12 24q0-2.49.93-4.68.96-2.19 2.58-3.81t3.81-2.55Q21.51 12 24 12q-2.49 0-4.68-.93a12.3 12.3 0 0 1-3.81-2.58 12.3 12.3 0 0 1-2.58-3.81Q12 2.49 12 0q0 2.49-.96 4.68-.93 2.19-2.55 3.81a12.3 12.3 0 0 1-3.81 2.58Q2.49 12 0 12q2.49 0 4.68.96 2.19.93 3.81 2.55t2.55 3.81" />
                        </svg></button>
                    <button onclick="openAI('detection', 'chatgpt')" class="ai-btn" title="Ask ChatGPT"><svg
                            viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M22.2819 9.8211a5.9847 5.9847 0 0 0-.5157-4.9108 6.0462 6.0462 0 0 0-6.5098-2.9A6.0651 6.0651 0 0 0 4.9807 4.1818a5.9847 5.9847 0 0 0-3.9977 2.9 6.0462 6.0462 0 0 0 .7427 7.0966 5.98 5.98 0 0 0 .511 4.9107 6.051 6.051 0 0 0 6.5146 2.9001A5.9847 5.9847 0 0 0 13.2599 24a6.0557 6.0557 0 0 0 5.7718-4.2058 5.9894 5.9894 0 0 0 3.9977-2.9001 6.0557 6.0557 0 0 0-.7475-7.0729zm-9.022 12.6081a4.4755 4.4755 0 0 1-2.8764-1.0408l.1419-.0804 4.7783-2.7582a.7948.7948 0 0 0 .3927-.6813v-6.7369l2.02 1.1686a.071.071 0 0 1 .038.052v5.5826a4.504 4.504 0 0 1-4.4945 4.4944zm-9.6607-4.1254a4.4708 4.4708 0 0 1-.5346-3.0137l.142.0852 4.783 2.7582a.7712.7712 0 0 0 .7806 0l5.8428-3.3685v2.3324a.0804.0804 0 0 1-.0332.0615L9.74 19.9502a4.4992 4.9992 0 0 1-6.1408-1.6464zM2.3408 7.8956a4.485 4.4847 0 0 1 2.3655-1.9728V11.6a.7664.7664 0 0 0 .3879.6765l5.8144 3.3543-2.0201 1.1685a.0757.0757 0 0 1-.071 0l-4.8303-2.7865A4.504 4.504 0 0 1 2.3408 7.872zm16.5963 3.8558L13.1038 8.364 15.1192 7.2a.0757.0757 0 0 1 .071 0l4.8303 2.7913a4.4944 4.4944 0 0 1-.6765 8.1042v-5.6772a.79.79 0 0 0-.407-.667zm2.0107-3.0231l-.142-.0852-4.7735-2.7818a.7759.7759 0 0 0-.7854 0L9.409 9.2297V6.8974a.0662.0662 0 0 1 .0284-.0615l4.8303-2.7866a4.4992 4.4992 0 0 1 6.6802 4.66zM8.3065 12.863l-2.02-1.1638a.0804.0804 0 0 1-.038-.0567V6.0742a4.4992 4.4992 0 0 1 7.3757-3.4537l-.142.0805L8.704 5.459a.7948.7948 0 0 0-.3927.6813zm1.0976-2.3654l2.602-1.4998 2.6069 1.4998v2.9994l-2.5974 1.4997-2.6067-1.4997Z" />
                        </svg></button>
                    <button onclick="openAI('detection', 'claude')" class="ai-btn" title="Ask Claude"><svg
                            xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision"
                            text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd"
                            clip-rule="evenodd" viewBox="0 0 512 509.64">
                            <path fill="#D77655"
                                d="M115.612 0h280.775C459.974 0 512 52.026 512 115.612v278.415c0 63.587-52.026 115.612-115.613 115.612H115.612C52.026 509.639 0 457.614 0 394.027V115.612C0 52.026 52.026 0 115.612 0z" />
                            <path fill="#FCF2EE" fill-rule="nonzero"
                                d="M142.27 316.619l73.655-41.326 1.238-3.589-1.238-1.996-3.589-.001-12.31-.759-42.084-1.138-36.498-1.516-35.361-1.896-8.897-1.895-8.34-10.995.859-5.484 7.482-5.03 10.717.935 23.683 1.617 35.537 2.452 25.782 1.517 38.193 3.968h6.064l.86-2.451-2.073-1.517-1.618-1.517-36.776-24.922-39.81-26.338-20.852-15.166-11.273-7.683-5.687-7.204-2.451-15.721 10.237-11.273 13.75.935 3.513.936 13.928 10.716 29.749 23.027 38.848 28.612 5.687 4.727 2.275-1.617.278-1.138-2.553-4.271-21.13-38.193-22.546-38.848-10.035-16.101-2.654-9.655c-.935-3.968-1.617-7.304-1.617-11.374l11.652-15.823 6.445-2.073 15.545 2.073 6.547 5.687 9.655 22.092 15.646 34.78 24.265 47.291 7.103 14.028 3.791 12.992 1.416 3.968 2.449-.001v-2.275l1.997-26.641 3.69-32.707 3.589-42.084 1.239-11.854 5.863-14.206 11.652-7.683 9.099 4.348 7.482 10.716-1.036 6.926-4.449 28.915-8.72 45.294-5.687 30.331h3.313l3.792-3.791 15.342-20.372 25.782-32.227 11.374-12.789 13.27-14.129 8.517-6.724 16.1-.001 11.854 17.617-5.307 18.199-16.581 21.029-13.75 17.819-19.716 26.54-12.309 21.231 1.138 1.694 2.932-.278 44.536-9.479 24.062-4.347 28.714-4.928 12.992 6.066 1.416 6.167-5.106 12.613-30.71 7.583-36.018 7.204-53.636 12.689-.657.48.758.935 24.164 2.275 10.337.556h25.301l47.114 3.514 12.309 8.139 7.381 9.959-1.238 7.583-18.957 9.655-25.579-6.066-59.702-14.205-20.474-5.106-2.83-.001v1.694l17.061 16.682 31.266 28.233 39.152 36.397 1.997 8.999-5.03 7.102-5.307-.758-34.401-25.883-13.27-11.651-30.053-25.302-1.996-.001v2.654l6.926 10.136 36.574 54.975 1.895 16.859-2.653 5.485-9.479 3.311-10.414-1.895-21.408-30.054-22.092-33.844-17.819-30.331-2.173 1.238-10.515 113.261-4.929 5.788-11.374 4.348-9.478-7.204-5.03-11.652 5.03-23.027 6.066-30.052 4.928-23.886 4.449-29.674 2.654-9.858-.177-.657-2.173.278-22.37 30.71-34.021 45.977-26.919 28.815-6.445 2.553-11.173-5.789 1.037-10.337 6.243-9.2 37.257-47.392 22.47-29.371 14.508-16.961-.101-2.451h-.859l-98.954 64.251-17.618 2.275-7.583-7.103.936-11.652 3.589-3.791 29.749-20.474-.101.102.024.101z" />
                        </svg></button>
                    <button onclick="openAI('detection', 'grok')" class="ai-btn" title="Ask Grok"><svg
                            xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision"
                            text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd"
                            clip-rule="evenodd" viewBox="0 0 512 509.641">
                            <path
                                d="M115.612 0h280.776C459.975 0 512 52.026 512 115.612v278.416c0 63.587-52.025 115.613-115.612 115.613H115.612C52.026 509.641 0 457.615 0 394.028V115.612C0 52.026 52.026 0 115.612 0z" />
                            <path fill="#fff"
                                d="M213.235 306.019l178.976-180.002v.169l51.695-51.763c-.924 1.32-1.86 2.605-2.785 3.89-39.281 54.164-58.46 80.649-43.07 146.922l-.09-.101c10.61 45.11-.744 95.137-37.398 131.836-46.216 46.306-120.167 56.611-181.063 14.928l42.462-19.675c38.863 15.278 81.392 8.57 111.947-22.03 30.566-30.6 37.432-75.159 22.065-112.252-2.92-7.025-11.67-8.795-17.792-4.263l-124.947 92.341zm-25.786 22.437l-.033.034L68.094 435.217c7.565-10.429 16.957-20.294 26.327-30.149 26.428-27.803 52.653-55.359 36.654-94.302-21.422-52.112-8.952-113.177 30.724-152.898 41.243-41.254 101.98-51.661 152.706-30.758 11.23 4.172 21.016 10.114 28.638 15.639l-42.359 19.584c-39.44-16.563-84.629-5.299-112.207 22.313-37.298 37.308-44.84 102.003-1.128 143.81z" />
                        </svg></button>
                </div>
            </div>
            <div class="visual-col">
                <canvas id="canvas-detection"></canvas>
            </div>
        </div>
    </section>

    <!-- Scripts -->
    <script src="../js/common.js"></script>
    <script>
        // ------------------------------------------------------------------
        // OPEN AI LINKS
        // ------------------------------------------------------------------
        function openAI(topic, model) {
            let prompt = "";
            switch (topic) {
                case 'spacetime':
                    prompt = "Explain gravitational waves as ripples in spacetime: Einstein's prediction, how they stretch and compress space, quadrupole moment, and why they're so hard to detect.";
                    break;
                case 'mergers':
                    prompt = "Explain binary black hole mergers: how they generate gravitational waves, inspiral-merger-ringdown process, chirp signals, and what LIGO has discovered.";
                    break;
                case 'detection':
                    prompt = "Explain how LIGO detects gravitational waves: laser interferometry, 4km arms, detecting changes smaller than a proton, 2015 discovery, and multi-messenger astronomy.";
                    break;
            }
            const encoded = encodeURIComponent(prompt);

            if (model === 'gemini') {
                navigator.clipboard.writeText(prompt).then(() => {
                    window.open('https://gemini.google.com/', '_blank');
                }).catch(err => {
                    window.open(`https://gemini.google.com/?q=${encoded}`, '_blank');
                });
                return;
            }

            let url = "";
            switch (model) {
                case 'perplexity': url = `https://www.perplexity.ai/search?q=${encoded}`; break;
                case 'chatgpt': url = `https://chatgpt.com/?q=${encoded}`; break;
                case 'claude': url = `https://claude.ai/new?q=${encoded}`; break;
                case 'grok': url = `https://grok.com/?q=${encoded}`; break;
            }
            if (url) window.open(url, '_blank');
        }

        // ------------------------------------------------------------------
        // APP CONTROLLER
        // ------------------------------------------------------------------
        const APP = {
            visuals: [],
            observer: null,

            init() {
                this.setupObserver();
                this.initScrollAnimations();
                this.initVisuals();
                this.initSliders();

                window.addEventListener('theme-changed', (e) => {
                    this.visuals.forEach(v => v.updateColors());
                });
            },

            setupObserver() {
                this.observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        const visual = this.visuals.find(v => v.canvas === entry.target);
                        if (visual) visual.isVisible = entry.isIntersecting;
                    });
                }, { threshold: 0.1 });
            },

            initScrollAnimations() {
                gsap.registerPlugin(ScrollTrigger);
                gsap.utils.toArray('h1, h2, h3').forEach(el => {
                    gsap.from(el, { opacity: 0, y: 30, duration: 1.2, ease: "power3.out", scrollTrigger: { trigger: el, start: "top 85%" } });
                });
                gsap.utils.toArray('.math-block').forEach(el => {
                    gsap.from(el, { scale: 0.95, opacity: 0, duration: 1, ease: "power2.out", scrollTrigger: { trigger: el, start: "top 90%" } });
                });
            },

            initVisuals() {
                this.addVisual(new SpacetimeVisual('canvas-spacetime'));
                this.addVisual(new MergersVisual('canvas-mergers'));
                this.addVisual(new DetectionVisual('canvas-detection'));
            },

            addVisual(visual) {
                this.visuals.push(visual);
                this.observer.observe(visual.canvas);
            },

            initSliders() {
                // Spacetime Ripples sliders
                document.getElementById('ripple-freq').addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    document.getElementById('ripple-freq-value').textContent = value.toFixed(1) + ' Hz';
                    const spacetime = this.visuals.find(v => v.canvas.id === 'canvas-spacetime');
                    if (spacetime) spacetime.setFrequency(value);
                });

                document.getElementById('ripple-amp').addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    document.getElementById('ripple-amp-value').textContent = value.toFixed(1);
                    const spacetime = this.visuals.find(v => v.canvas.id === 'canvas-spacetime');
                    if (spacetime) spacetime.setAmplitude(value);
                });

                // Mergers sliders
                document.getElementById('merger-mass').addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    document.getElementById('merger-mass-value').textContent = value.toFixed(0) + ' M☉';
                    const mergers = this.visuals.find(v => v.canvas.id === 'canvas-mergers');
                    if (mergers) mergers.setMass(value);
                });

                document.getElementById('merger-sep').addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    document.getElementById('merger-sep-value').textContent = value.toFixed(0) + ' km';
                    const mergers = this.visuals.find(v => v.canvas.id === 'canvas-mergers');
                    if (mergers) mergers.setSeparation(value);
                });

                // Detection sliders
                document.getElementById('detection-freq').addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    document.getElementById('detection-freq-value').textContent = value.toFixed(0) + ' Hz';
                    const detection = this.visuals.find(v => v.canvas.id === 'canvas-detection');
                    if (detection) detection.setFrequency(value);
                });

                document.getElementById('detection-amp').addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    document.getElementById('detection-amp-value').textContent = value.toFixed(1);
                    const detection = this.visuals.find(v => v.canvas.id === 'canvas-detection');
                    if (detection) detection.setAmplitude(value);
                });
            }
        };

        window.onload = () => APP.init();

        // ------------------------------------------------------------------
        // BASE VISUAL CLASS
        // ------------------------------------------------------------------
        class BaseVisual {
            constructor(id) {
                this.canvas = document.getElementById(id);
                this.ctx = this.canvas.getContext('2d');
                this.isVisible = false;
                this.updateColors();
                this.resize();
                window.addEventListener('resize', () => this.resize());
                this.loop();
            }

            updateColors() {
                this.color = getComputedStyle(document.body).getPropertyValue('--text-main').trim();
                this.bg = getComputedStyle(document.body).getPropertyValue('--bg-color').trim();
                this.accent = getComputedStyle(document.body).getPropertyValue('--accent').trim();
                this.secondary = getComputedStyle(document.body).getPropertyValue('--accent-secondary').trim();
            }

            resize() {
                const rect = this.canvas.parentElement.getBoundingClientRect();
                this.canvas.width = rect.width * 2;
                this.canvas.height = rect.height * 2;
                this.scale = 2;
                this.cx = this.canvas.width / 2;
                this.cy = this.canvas.height / 2;
            }

            loop() {
                if (this.isVisible) this.draw();
                requestAnimationFrame(() => this.loop());
            }

            draw() { }
        }

        // ------------------------------------------------------------------
        // SPACETIME RIPPLES VISUALIZATION
        // ------------------------------------------------------------------
        class SpacetimeVisual extends BaseVisual {
            constructor(id) {
                super(id);
                this.time = 0;
                this.frequency = 1.0;
                this.amplitude = 1.0;
            }

            setFrequency(value) {
                this.frequency = value;
            }

            setAmplitude(value) {
                this.amplitude = value;
            }

            draw() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.time += 0.03 * this.frequency;

                // Draw grid representing spacetime
                const gridSize = 40;
                const cols = Math.ceil(this.canvas.width / gridSize);
                const rows = Math.ceil(this.canvas.height / gridSize);

                // Calculate wave parameters
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                const waveFreq = 0.02 * this.frequency;
                const waveSpeed = 0.05 * this.frequency;
                const waveAmp = 15 * this.amplitude;

                this.ctx.lineWidth = 1;

                // Draw horizontal lines with distortion
                for (let row = 0; row <= rows; row++) {
                    this.ctx.strokeStyle = this.color;
                    this.ctx.globalAlpha = 0.3;
                    this.ctx.beginPath();

                    for (let col = 0; col <= cols; col++) {
                        const x = col * gridSize;
                        const y = row * gridSize;

                        // Calculate distance from center
                        const dx = x - centerX;
                        const dy = y - centerY;
                        const dist = Math.sqrt(dx * dx + dy * dy);

                        // Calculate wave amplitude (decays with distance)
                        const wave = Math.sin(dist * waveFreq - this.time * waveSpeed * 2) * waveAmp * Math.exp(-dist * 0.002);

                        // Apply plus-polarization distortion
                        const distortedX = x + wave * (dx / dist || 0) * 0.5;
                        const distortedY = y + wave * (dy / dist || 0) * 0.5;

                        if (col === 0) {
                            this.ctx.moveTo(distortedX, distortedY);
                        } else {
                            this.ctx.lineTo(distortedX, distortedY);
                        }
                    }
                    this.ctx.stroke();
                }

                // Draw vertical lines with distortion
                for (let col = 0; col <= cols; col++) {
                    this.ctx.strokeStyle = this.color;
                    this.ctx.globalAlpha = 0.3;
                    this.ctx.beginPath();

                    for (let row = 0; row <= rows; row++) {
                        const x = col * gridSize;
                        const y = row * gridSize;

                        // Calculate distance from center
                        const dx = x - centerX;
                        const dy = y - centerY;
                        const dist = Math.sqrt(dx * dx + dy * dy);

                        // Calculate wave amplitude
                        const wave = Math.sin(dist * waveFreq - this.time * waveSpeed * 2) * waveAmp * Math.exp(-dist * 0.002);

                        // Apply plus-polarization distortion
                        const distortedX = x - wave * (dx / dist || 0) * 0.5;
                        const distortedY = y - wave * (dy / dist || 0) * 0.5;

                        if (row === 0) {
                            this.ctx.moveTo(distortedX, distortedY);
                        } else {
                            this.ctx.lineTo(distortedX, distortedY);
                        }
                    }
                    this.ctx.stroke();
                }

                this.ctx.globalAlpha = 1;

                // Draw source at center
                this.ctx.fillStyle = this.accent;
                this.ctx.beginPath();
                this.ctx.arc(centerX, centerY, 15, 0, Math.PI * 2);
                this.ctx.fill();

                // Draw label
                this.ctx.font = 'bold 16px Inter';
                this.ctx.fillStyle = this.color;
                this.ctx.textAlign = 'center';
                this.ctx.fillText('Spacetime Grid', centerX, this.canvas.height - 20);
            }
        }

        // ------------------------------------------------------------------
        // BINARY MERGERS VISUALIZATION
        // ------------------------------------------------------------------
        class MergersVisual extends BaseVisual {
            constructor(id) {
                super(id);
                this.angle = 0;
                this.separation = 120;
                this.mass = 30;
                this.merged = false;
            }

            setMass(value) {
                this.mass = value;
            }

            setSeparation(value) {
                this.separation = value;
            }

            draw() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

                // Animate inspiral - faster for heavier masses
                const speed = 0.05 * (this.mass / 30);
                this.angle += speed;
                this.separation *= 0.998;

                // Reset if merged
                if (this.separation < 20) {
                    this.separation = parseFloat(document.getElementById('merger-sep').value);
                    this.merged = true;
                    setTimeout(() => this.merged = false, 500);
                }

                // Calculate black hole positions
                const r = this.separation / 2;
                const x1 = this.cx + Math.cos(this.angle) * r;
                const y1 = this.cy + Math.sin(this.angle) * r;
                const x2 = this.cx - Math.cos(this.angle) * r;
                const y2 = this.cy - Math.sin(this.angle) * r;

                // Draw gravitational waves - amplitude depends on mass
                this.ctx.strokeStyle = this.secondary;
                this.ctx.lineWidth = 2;
                const waveCount = 5;
                const waveAmp = this.mass / 30;
                for (let i = 0; i < waveCount; i++) {
                    const radius = (this.time % (waveCount * 30)) + i * 30;
                    const alpha = (1 - (radius / (waveCount * 30))) * waveAmp;
                    this.ctx.globalAlpha = alpha * 0.5;
                    this.ctx.beginPath();
                    this.ctx.arc(this.cx, this.cy, radius, 0, Math.PI * 2);
                    this.ctx.stroke();
                }
                this.ctx.globalAlpha = 1;

                // Draw black holes - size depends on mass
                const bhRadius = 20 + (this.mass - 30) * 0.3 + (120 - this.separation) * 0.1;

                // Black hole 1
                this.ctx.fillStyle = this.accent;
                this.ctx.beginPath();
                this.ctx.arc(x1, y1, bhRadius, 0, Math.PI * 2);
                this.ctx.fill();

                // Black hole 2
                this.ctx.fillStyle = this.secondary;
                this.ctx.beginPath();
                this.ctx.arc(x2, y2, bhRadius, 0, Math.PI * 2);
                this.ctx.fill();

                // Draw orbit path
                this.ctx.strokeStyle = this.color;
                this.ctx.lineWidth = 1;
                this.ctx.globalAlpha = 0.3;
                this.ctx.beginPath();
                this.ctx.arc(this.cx, this.cy, r, 0, Math.PI * 2);
                this.ctx.stroke();
                this.ctx.globalAlpha = 1;

                // Labels
                this.ctx.font = 'bold 14px Inter';
                this.ctx.fillStyle = this.color;
                this.ctx.textAlign = 'center';
                this.ctx.fillText('Binary Inspiral', this.cx, this.canvas.height - 20);
            }
        }

        // ------------------------------------------------------------------
        // DETECTION VISUALIZATION
        // ------------------------------------------------------------------
        class DetectionVisual extends BaseVisual {
            constructor(id) {
                super(id);
                this.time = 0;
                this.waveData = [];
                this.frequency = 100;
                this.amplitude = 1.0;
            }

            setFrequency(value) {
                this.frequency = value;
            }

            setAmplitude(value) {
                this.amplitude = value;
            }

            draw() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.time += 0.05;

                // Generate gravitational wave signal (chirp)
                const freq = (this.frequency / 100) * 0.02 + Math.sin(this.time * 0.5) * 0.01;
                const amplitude = (30 + Math.sin(this.time * 0.3) * 20) * this.amplitude;
                const signal = Math.sin(this.time * this.frequency / 10) * amplitude;

                // Add to wave data
                this.waveData.push(signal);
                if (this.waveData.length > 200) {
                    this.waveData.shift();
                }

                // Draw LIGO-style interferometer arms
                const armLength = Math.min(this.canvas.width, this.canvas.height) * 0.35;
                const armWidth = 20;

                // Horizontal arm
                this.ctx.fillStyle = this.color;
                this.ctx.globalAlpha = 0.3;
                this.ctx.fillRect(this.cx - armLength, this.cy - armWidth/2, armLength, armWidth);

                // Vertical arm
                this.ctx.fillRect(this.cx - armWidth/2, this.cy, armWidth, armLength);

                // Draw laser beams
                this.ctx.strokeStyle = this.accent;
                this.ctx.lineWidth = 2;
                this.ctx.globalAlpha = 1;

                // Horizontal beam
                this.ctx.beginPath();
                this.ctx.moveTo(this.cx, this.cy);
                this.ctx.lineTo(this.cx - armLength, this.cy);
                this.ctx.stroke();

                // Vertical beam
                this.ctx.beginPath();
                this.ctx.moveTo(this.cx, this.cy);
                this.ctx.lineTo(this.cx, this.cy + armLength);
                this.ctx.stroke();

                // Draw detector at corner
                this.ctx.fillStyle = this.secondary;
                this.ctx.beginPath();
                this.ctx.arc(this.cx, this.cy, 15, 0, Math.PI * 2);
                this.ctx.fill();

                // Draw wave signal graph at bottom
                const graphX = 40;
                const graphY = this.canvas.height - 100;
                const graphWidth = this.canvas.width - 80;
                const graphHeight = 60;

                // Draw graph background
                this.ctx.strokeStyle = this.color;
                this.ctx.lineWidth = 1;
                this.ctx.globalAlpha = 0.3;
                this.ctx.strokeRect(graphX, graphY, graphWidth, graphHeight);
                this.ctx.globalAlpha = 1;

                // Draw signal - scaled by amplitude slider
                this.ctx.strokeStyle = this.accent;
                this.ctx.lineWidth = 2;
                this.ctx.beginPath();

                for (let i = 0; i < this.waveData.length; i++) {
                    const x = graphX + (i / this.waveData.length) * graphWidth;
                    const y = graphY + graphHeight / 2 + this.waveData[i] * this.amplitude;

                    if (i === 0) {
                        this.ctx.moveTo(x, y);
                    } else {
                        this.ctx.lineTo(x, y);
                    }
                }
                this.ctx.stroke();

                // Labels
                this.ctx.font = 'bold 14px Inter';
                this.ctx.fillStyle = this.color;
                this.ctx.textAlign = 'center';
                this.ctx.fillText('LIGO Interferometer', this.cx, graphY - 15);
            }
        }
    </script>
</body>

</html>
